const db = "CorporeRM"

const sqlSipef = (CODFILIAL, DATAINICIAL, DATAFINAL) => {
	const sql = `
	USE ${db};
	SELECT
		DISTINCT '0200' AS 'REG', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = IC.CODCONTA
		) AS 'CONTACONTABIL', 
		I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA', 
		I.NUMBANCO AS 'CODIGO BANCO', 
		J.NOME AS 'NOME BANCO', 
		I.NUMAGENCIA AS 'BANCO AGÊNCIA', 
		K.DIGAG AS 'DIG AGÊNCIA', 
		I.NROCONTA AS CONTA, 
		L.DIGCONTA AS 'DIG CONTA', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			FXCX X (NOLOCK) 
			WHERE 
			X.CODCOLIGADA = 1 
			AND B.CODFILIAL = X.CODFILIAL 
			AND B.CODCXA = X.CODCXA 
			AND X.DATACOMPENSACAO >= (
				CASE WHEN B.CODFILIAL = 23 THEN '20231124' WHEN B.CODFILIAL = 27 THEN '20231124' WHEN B.CODFILIAL = 28 THEN '20231123' ELSE '${DATAINICIAL}' END
			) 
			AND X.DATACOMPENSACAO < '${DATAINICIAL}'
		) AS 'SALDO PERIODO ANTERIOR', 
		CASE WHEN A.CODTDO IN ('016', '108') THEN '31' WHEN A.CODTDO IN ('103', '010', '035', '043') THEN '9'
		WHEN A.CODIGO IN ('036','052','129') THEN 50
		WHEN A.CODIGO IN ('036','052','129') THEN 50
		ELSE ZO.OPERACAOID END AS 'OPERACAOID', 
		ZCL.CLASSPAGAMENTO AS 'CLASS. PAGAMENTO', 
		ZC.TIPOFORNECEDOR, 
		ZC.CLASSEFORNECEDOR, 
		CASE WHEN B.IDFORMAPAGTO = 1 THEN 6 WHEN B.IDFORMAPAGTO = 2 THEN 1 WHEN B.IDFORMAPAGTO IN (3, 4, 5, 6, 7) THEN (
			CASE WHEN FC.ESTSERV = '01' THEN 7 ELSE 19 END
		) ELSE 16 END AS 'DOCTIPOID', 
		B.IDBAIXA AS 'NOPERACAO', 
		CASE WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV ELSE A.NUMERODOCUMENTO END AS 'NDOCFIN', 
		FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'COMPETÊNCIA REFERENCIA', 
		FORMAT(B.DATABAIXA, 'dd/MM/yyyy') AS 'DATA', 
		B.VALORBAIXA AS 'VALOR', 
		A.SERIEDOCUMENTO AS 'SERIENF', 
		CASE WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV ELSE A.NUMERODOCUMENTO END AS 'NFDOC', 
		FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'DATANFDOC', 
		FORMAT(A.DATAVENCIMENTO, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA', 
		O.CODIGOCONTRATO AS 'NCONTRATO', 
		'' AS 'OBJETO CONTRATO', 
		O.NOME AS 'CONTRATO DESCRIÇÃO', 
		CASE WHEN P.CGCCFO IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE P.CGCCFO END AS 'CNPJ CONTRATO', 
		FORMAT(O.DATAINICIO, 'dd/MM/yyyy') AS 'CONTRATO INÍCIO VIGENCIA', 
		FORMAT(O.DATAFIM, 'dd/MM/yyyy') AS 'CONTRATO FIM VIGENCIA', 
		O.VALORCONTRATO AS 'VALOR CONTRATO', 
		(
			SELECT 
			ISNULL(
				SUM(X.VALORTOTAL), 
				0
			) 
			FROM 
			TITMCNT X (NOLOCK) 
			WHERE 
			X.IDCNT = ISNULL(NMP.IDCNT, N.IDCNT)
		) AS 'VALOR PARC CONTRATO', 
		'' AS 'SERIE PARC CONTRATO', 
		CASE WHEN ISNULL(NMP.IDCNT, N.IDCNT) IS NOT NULL THEN 'S' ELSE 'N' END 'POSSUI CONTRATO', 
		CASE WHEN A.CHAPA IS NOT NULL THEN PP.CPF WHEN P.CGCCFO IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE P.CGCCFO END AS 'CNPJ CPF PARTICIPANTE', 
		CASE WHEN A.CHAPA IS NOT NULL THEN PF.NOME ELSE P.NOMEFANTASIA END AS 'NOME PARTICIPANTE', 
		A.VALORORIGINAL AS 'VALOR DOC', 
		ISNULL(B.VALORMULTA, 0)+ ISNULL(B.VALORJUROS, 0) AS 'MULTAJUROS', 
		ISNULL(TM.VALORFRETE, 0) AS 'FRETE', 
		ISNULL(A.VALOROP2 + A.VALOROP6, 0) AS 'INSS', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			TTRBMOV (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDMOV = A.IDMOV 
			AND CODTRB = 'ICMSST'
		) AS 'ICMSST', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			TTRBMOV (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDMOV = A.IDMOV 
			AND CODTRB = 'IPI'
		) AS 'IPI', 
		ISNULL(A.VALOROP1, 0) AS 'ISS', 
		ISNULL(A.VALORIRRF + A.VALOROP7, 0) AS 'IR', 
		0 AS 'PIS', 
		0 AS 'COFINS', 
		0 AS 'CSLL', 
		ISNULL(R.VALOR, 0) AS 'CSRF', 
		CASE WHEN TM.VALORDESC > 0 THEN ISNULL(TM.VALORDESC, 0) ELSE ISNULL(B.VALORDESCONTO, 0) END AS 'DESCONTO', 
		CASE WHEN TM.CHAVEACESSONFE IS NULL THEN TM.CHAVEACESSONFE ELSE TM.CHAVEACESSONFE END AS 'CHAVE NF-E', 
		CASE WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '23'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 93/2023'
		) WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '27'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 92/2023'
		) WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '28'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 90/2023'
		) ELSE A.HISTORICO END AS 'HISTORICO', 
		CAST(T.HISTORICOCURTO AS VARCHAR) + CAST(T.HISTORICOLONGO AS VARCHAR) AS 'OBS DANFE', 
		'S' AS 'CONCILIADO', 
		'' AS 'ARQUIVO CERTIDÃO', 
		ISNULL(
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'MOVMOVIMENTODATA' 
				AND X.DESCRICAO LIKE 'CP%' 
				AND X.CHAVE = TM.IDMOV
			), 
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'FINLANDATABR' 
				AND X.DESCRICAO LIKE 'CP%' 
				AND X.CHAVE = A.IDLAN
			)
		) AS 'ARQUIVO NF', 
		'' AS 'ARQUIVO CONTRATO', 
		'' AS 'ARQUIVO XML', 
		'' AS 'CENTRO DE CUSTO', 
		'N' AS 'RETIFICADA', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = IC.CODCONTA
		) AS 'CONTA CONTÁBIL GERAL', 
		'N' AS 'CONTRATO PARCELA VARIAVEL', 
		O.NOME AS 'CONTRATO DESCRICÃO SERVICO', 
		P.NOMEFANTASIA AS 'CONTRATO NOME FANTASIA', 
		ISNULL(
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'MOVMOVIMENTODATA' 
				AND X.DESCRICAO LIKE 'DOC%' 
				AND X.CHAVE = TM.IDMOV
			), 
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'FINLANDATABR' 
				AND X.DESCRICAO LIKE 'DOC%' 
				AND X.CHAVE = A.IDLAN
			)
		) AS 'ARQUIVO PESQUISA' 
		FROM 
		FLAN A (NOLOCK) 
		INNER JOIN FLANBAIXA B (NOLOCK) ON A.IDLAN = B.IDLAN 
		AND A.CODCOLIGADA = B.CODCOLIGADA 
		LEFT JOIN FCXA I (NOLOCK) ON B.CODCXA = I.CODCXA 
		AND B.CODCOLCXA = I.CODCOLPROP 
		LEFT JOIN FCXACONT IC (NOLOCK) ON I.CODCOLIGADA = IC.CODCOLIGADA 
		AND I.CODCXA = IC.CODCXA 
		AND IC.TIPO = 1 
		LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO 
		LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO 
		AND I.NUMAGENCIA = K.NUMAGENCIA 
		LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA 
		AND I.NUMBANCO = L.NUMBANCO 
		AND I.NUMAGENCIA = L.NUMAGENCIA 
		LEFT JOIN TITMMOV N (NOLOCK) ON A.IDMOV = N.IDMOV 
		AND A.CODCOLIGADA = N.CODCOLIGADA 
		LEFT JOIN TMOV TM (NOLOCK) ON N.IDMOV = TM.IDMOV 
		AND N.CODCOLIGADA = TM.CODCOLIGADA 
		LEFT JOIN TMOVRELAC TMR (NOLOCK) ON TM.CODCOLIGADA = TMR.CODCOLDESTINO 
		AND TM.IDMOV = TMR.IDMOVDESTINO 
		LEFT JOIN TMOV TMP (NOLOCK) ON TMR.CODCOLORIGEM = TMP.CODCOLIGADA 
		AND TMP.IDMOV = TMR.IDMOVORIGEM 
		LEFT JOIN TITMMOV NMP (NOLOCK) ON TMP.CODCOLIGADA = NMP.CODCOLIGADA 
		AND TMP.IDMOV = NMP.IDMOV 
		AND NMP.NSEQITMMOV = 1 
		LEFT JOIN TCNT O (NOLOCK) ON ISNULL(NMP.IDCNT, N.IDCNT)= O.IDCNT 
		AND ISNULL(NMP.CODCOLIGADA, N.CODCOLIGADA)= O.CODCOLIGADA 
		AND ISNULL(NMP.CODFILIAL, N.CODFILIAL)= O.CODFILIAL 
		AND TMP.CODCFO = O.CODCFO 
		LEFT JOIN FCFO P (NOLOCK) ON A.CODCFO = P.CODCFO 
		AND A.CODCOLCFO = P.CODCOLIGADA 
		LEFT JOIN GFILIAL Q (NOLOCK) ON A.CODFILIAL = Q.CODFILIAL 
		AND A.CODCOLIGADA = Q.CODCOLIGADA 
		LEFT JOIN FTRBLAN R (NOLOCK) ON A.IDLAN = R.IDLAN 
		AND A.CODCOLIGADA = R.CODCOLIGADA 
		LEFT JOIN TNFEENTRADA S (NOLOCK) ON TM.IDMOV = S.IDMOV 
		AND TM.CODCOLIGADA = S.CODCOLIGADA 
		LEFT JOIN TMOVHISTORICO T (NOLOCK) ON TM.IDMOV = T.IDMOV 
		AND TM.CODCOLIGADA = T.CODCOLIGADA 
		LEFT JOIN ZOPERACAOID_SAIDAS ZO ON A.CODTB3FLX = ZO.CODTB3FLX 
		AND A.CODCOLIGADA = 1 
		LEFT JOIN FCFOCOMPL FC (NOLOCK) ON A.CODCFO = FC.CODCFO 
		AND A.CODCOLCFO = FC.CODCOLIGADA 
		LEFT JOIN ZCLASSPAGAMENTO ZCL ON A.CODTB3FLX = ZCL.CODTB3FLX 
		LEFT JOIN ZCLASSEFORNECEDOR2 ZC ON A.CODTB3FLX = ZC.CODTB3FLX 
		AND A.CODCOLIGADA = ZC.CODCOLIGADA 
		LEFT JOIN PFUNC PF (NOLOCK) ON A.CHAPA = PF.CHAPA 
		LEFT JOIN PPESSOA PP (NOLOCK) ON PF.CODPESSOA = PP.CODIGO 
		WHERE 
		A.CODCOLIGADA = 1 
		AND A.CODFILIAL = ${CODFILIAL} 
		AND B.DATABAIXA >= '${DATAINICIAL}' 
		AND B.DATABAIXA <= '${DATAFINAL}' 
		AND A.PAGREC = 2 
		AND B.STATUS <> 1 
		AND A.STATUSLAN <> 2 
		AND B.VALORBAIXA = 0 
		AND IC.CODCONTA LIKE '1.1.1%' 
		UNION 
		SELECT 
		DISTINCT '0200' AS 'REG', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTACONTABIL', 
		I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA', 
		I.NUMBANCO AS 'CODIGO BANCO', 
		J.NOME AS 'NOME BANCO', 
		I.NUMAGENCIA AS 'BANCO AGÊNCIA', 
		K.DIGAG AS 'DIG AGÊNCIA', 
		I.NROCONTA AS CONTA, 
		L.DIGCONTA AS 'DIG CONTA', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			FXCX X (NOLOCK) 
			WHERE 
			X.CODCOLIGADA = 1 
			AND B.CODFILIAL = X.CODFILIAL 
			AND B.CODCXA = X.CODCXA 
			AND X.DATACOMPENSACAO >= (
				CASE WHEN B.CODFILIAL = 23 THEN '20231124' WHEN B.CODFILIAL = 27 THEN '20231124' WHEN B.CODFILIAL = 28 THEN '20231123' ELSE '${DATAINICIAL}' END
			) 
			AND X.DATACOMPENSACAO < '${DATAINICIAL}'
		) AS 'SALDO PERIODO ANTERIOR', 
		CASE WHEN A.CODTDO IN ('016', '108') THEN '31' WHEN A.CODTDO IN ('103', '010', '035', '043') THEN '9' 
		WHEN A.CODIGO IN ('036','052','129') THEN 50
		ELSE ZO.OPERACAOID END AS 'OPERACAOID', 
		ZCL.CLASSPAGAMENTO AS 'CLASS. PAGAMENTO', 
		ZC.TIPOFORNECEDOR, 
		ZC.CLASSEFORNECEDOR, 
		CASE WHEN B.IDFORMAPAGTO = 1 THEN 6 WHEN B.IDFORMAPAGTO = 2 THEN 1 WHEN B.IDFORMAPAGTO IN (3, 4, 5, 6, 7) THEN (
			CASE WHEN FC.ESTSERV = '01' THEN 7 ELSE 19 END
		) ELSE 16 END AS 'DOCTIPOID', 
		B.IDXCX AS 'NOPERACAO', 
		CASE WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV ELSE A.NUMERODOCUMENTO END AS 'NDOCFIN', 
		FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'COMPETÊNCIA REFERENCIA', 
		FORMAT(B.DATABAIXA, 'dd/MM/yyyy') AS 'DATA', 
		B.VALORBAIXA AS 'VALOR', 
		A.SERIEDOCUMENTO AS 'SERIENF', 
		CASE WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV ELSE A.NUMERODOCUMENTO END AS 'NFDOC', 
		FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'DATANFDOC', 
		FORMAT(A.DATAVENCIMENTO, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA', 
		O.CODIGOCONTRATO AS 'NCONTRATO', 
		'' AS 'OBJETO CONTRATO', 
		O.NOME AS 'CONTRATO DESCRIÇÃO', 
		CASE WHEN P.CGCCFO IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE P.CGCCFO END AS 'CNPJ CONTRATO', 
		FORMAT(O.DATAINICIO, 'dd/MM/yyyy') AS 'CONTRATO INÍCIO VIGENCIA', 
		FORMAT(O.DATAFIM, 'dd/MM/yyyy') AS 'CONTRATO FIM VIGENCIA', 
		O.VALORCONTRATO AS 'VALOR CONTRATO', 
		(
			SELECT 
			ISNULL(
				SUM(X.VALORTOTAL), 
				0
			) 
			FROM 
			TITMCNT X (NOLOCK) 
			WHERE 
			X.IDCNT = ISNULL(NMP.IDCNT, N.IDCNT)
		) AS 'VALOR PARC CONTRATO', 
		'' AS 'SERIE PARC CONTRATO', 
		CASE WHEN ISNULL(NMP.IDCNT, N.IDCNT) IS NOT NULL THEN 'S' ELSE 'N' END 'POSSUI CONTRATO', 
		CASE WHEN A.CHAPA IS NOT NULL THEN PP.CPF WHEN P.CGCCFO IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE P.CGCCFO END AS 'CNPJ CPF PARTICIPANTE', 
		CASE WHEN A.CHAPA IS NOT NULL THEN PF.NOME ELSE P.NOMEFANTASIA END AS 'NOME PARTICIPANTE', 
		A.VALORORIGINAL AS 'VALOR DOC', 
		ISNULL(B.VALORMULTA, 0)+ ISNULL(B.VALORJUROS, 0) AS 'MULTAJUROS', 
		ISNULL(TM.VALORFRETE, 0) AS 'FRETE', 
		ISNULL(A.VALOROP2 + A.VALOROP6, 0) AS 'INSS', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			TTRBMOV (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDMOV = A.IDMOV 
			AND CODTRB = 'ICMSST'
		) AS 'ICMSST', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			TTRBMOV (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDMOV = A.IDMOV 
			AND CODTRB = 'IPI'
		) AS 'IPI', 
		ISNULL(A.VALOROP1, 0) AS 'ISS', 
		ISNULL(A.VALORIRRF + A.VALOROP7, 0) AS 'IR', 
		0 AS 'PIS', 
		0 AS 'COFINS', 
		0 AS 'CSLL', 
		ISNULL(R.VALOR, 0) AS 'CSRF', 
		CASE WHEN TM.VALORDESC > 0 THEN ISNULL(TM.VALORDESC, 0) ELSE ISNULL(B.VALORDESCONTO, 0) END AS 'DESCONTO', 
		CASE WHEN TM.CHAVEACESSONFE IS NULL THEN TM.CHAVEACESSONFE ELSE TM.CHAVEACESSONFE END AS 'CHAVE NF-E', 
		CASE WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '23'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 93/2023'
		) WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '27'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 92/2023'
		) WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '28'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 90/2023'
		) ELSE A.HISTORICO END AS 'HISTORICO', 
		CAST(T.HISTORICOCURTO AS VARCHAR) + CAST(T.HISTORICOLONGO AS VARCHAR) AS 'OBS DANFE', 
		'S' AS 'CONCILIADO', 
		'' AS 'ARQUIVO CERTIDÃO', 
		ISNULL(
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'MOVMOVIMENTODATA' 
				AND X.DESCRICAO LIKE 'CP%' 
				AND X.CHAVE = TM.IDMOV
			), 
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'FINLANDATABR' 
				AND X.DESCRICAO LIKE 'CP%' 
				AND X.CHAVE = A.IDLAN
			)
		) AS 'ARQUIVO NF', 
		'' AS 'ARQUIVO CONTRATO', 
		'' AS 'ARQUIVO XML', 
		'' AS 'CENTRO DE CUSTO', 
		'N' AS 'RETIFICADA', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTA CONTÁBIL GERAL', 
		'N' AS 'CONTRATO PARCELA VARIAVEL', 
		O.NOME AS 'CONTRATO DESCRICÃO SERVICO', 
		P.NOMEFANTASIA AS 'CONTRATO NOME FANTASIA', 
		ISNULL(
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'MOVMOVIMENTODATA' 
				AND X.DESCRICAO LIKE 'DOC%' 
				AND X.CHAVE = TM.IDMOV
			), 
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'FINLANDATABR' 
				AND X.DESCRICAO LIKE 'DOC%' 
				AND X.CHAVE = A.IDLAN
			)
		) AS 'ARQUIVO PESQUISA' 
		FROM 
		FLAN A (NOLOCK) 
		INNER JOIN FLANBAIXA B (NOLOCK) ON A.IDLAN = B.IDLAN 
		AND A.CODCOLIGADA = B.CODCOLIGADA 
		INNER JOIN COPERACAO C (NOLOCK) ON B.IDOPERACAO = C.IDOPERACAO 
		AND B.CODCOLIGADA = C.CODCOLIGADA 
		INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO 
		AND C.CODCOLIGADA = D.CODCOLIGADA 
		INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA 
		AND D.CODCOLIGADA = E.CODCOLIGADA 
		LEFT JOIN CCONTA H (NOLOCK) ON E.CREDITO = H.CODCONTA 
		AND E.CODCOLCREDITO = H.CODCOLIGADA 
		LEFT JOIN FCXA I (NOLOCK) ON B.CODCXA = I.CODCXA 
		AND B.CODCOLCXA = I.CODCOLPROP 
		LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO 
		LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO 
		AND I.NUMAGENCIA = K.NUMAGENCIA 
		LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA 
		AND I.NUMBANCO = L.NUMBANCO 
		AND I.NUMAGENCIA = L.NUMAGENCIA 
		LEFT JOIN TITMMOV N (NOLOCK) ON A.IDMOV = N.IDMOV 
		AND A.CODCOLIGADA = N.CODCOLIGADA 
		LEFT JOIN TMOV TM (NOLOCK) ON N.IDMOV = TM.IDMOV 
		AND N.CODCOLIGADA = TM.CODCOLIGADA 
		LEFT JOIN TMOVRELAC TMR (NOLOCK) ON TM.CODCOLIGADA = TMR.CODCOLDESTINO 
		AND TM.IDMOV = TMR.IDMOVDESTINO 
		LEFT JOIN TMOV TMP (NOLOCK) ON TMR.CODCOLORIGEM = TMP.CODCOLIGADA 
		AND TMP.IDMOV = TMR.IDMOVORIGEM 
		LEFT JOIN TITMMOV NMP (NOLOCK) ON TMP.CODCOLIGADA = NMP.CODCOLIGADA 
		AND TMP.IDMOV = NMP.IDMOV 
		AND NMP.NSEQITMMOV = 1 
		LEFT JOIN TCNT O (NOLOCK) ON ISNULL(NMP.IDCNT, N.IDCNT)= O.IDCNT 
		AND ISNULL(NMP.CODCOLIGADA, N.CODCOLIGADA)= O.CODCOLIGADA 
		AND ISNULL(NMP.CODFILIAL, N.CODFILIAL)= O.CODFILIAL 
		AND TMP.CODCFO = O.CODCFO 
		LEFT JOIN FCFO P (NOLOCK) ON A.CODCFO = P.CODCFO 
		AND A.CODCOLCFO = P.CODCOLIGADA 
		LEFT JOIN GFILIAL Q (NOLOCK) ON A.CODFILIAL = Q.CODFILIAL 
		AND A.CODCOLIGADA = Q.CODCOLIGADA 
		LEFT JOIN FTRBLAN R (NOLOCK) ON A.IDLAN = R.IDLAN 
		AND A.CODCOLIGADA = R.CODCOLIGADA 
		LEFT JOIN TNFEENTRADA S (NOLOCK) ON TM.IDMOV = S.IDMOV 
		AND TM.CODCOLIGADA = S.CODCOLIGADA 
		LEFT JOIN TMOVHISTORICO T (NOLOCK) ON TM.IDMOV = T.IDMOV 
		AND TM.CODCOLIGADA = T.CODCOLIGADA 
		LEFT JOIN ZOPERACAOID_SAIDAS ZO ON A.CODTB3FLX = ZO.CODTB3FLX 
		AND A.CODCOLIGADA = 1 
		LEFT JOIN FCFOCOMPL FC (NOLOCK) ON A.CODCFO = FC.CODCFO 
		AND A.CODCOLCFO = FC.CODCOLIGADA 
		LEFT JOIN ZCLASSPAGAMENTO ZCL ON A.CODTB3FLX = ZCL.CODTB3FLX 
		LEFT JOIN ZCLASSEFORNECEDOR2 ZC ON A.CODTB3FLX = ZC.CODTB3FLX 
		AND A.CODCOLIGADA = ZC.CODCOLIGADA 
		LEFT JOIN PFUNC PF (NOLOCK) ON A.CHAPA = PF.CHAPA 
		LEFT JOIN PPESSOA PP (NOLOCK) ON PF.CODPESSOA = PP.CODIGO 
		WHERE 
		A.CODCOLIGADA = 1 
		AND A.CODFILIAL = ${CODFILIAL} 
		AND B.DATABAIXA >= '${DATAINICIAL}' 
		AND B.DATABAIXA <= '${DATAFINAL}' 
		AND A.PAGREC = 2 
		AND B.STATUS <> 1 
		AND A.STATUSLAN <> 2 
		AND A.NFOUDUP <> 1 
		AND E.CREDITO LIKE '1.1.1%' 
		UNION 
		SELECT 
		DISTINCT '0200' AS 'REG', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTACONTABIL', 
		I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA', 
		I.NUMBANCO AS 'CODIGO BANCO', 
		J.NOME AS 'NOME BANCO', 
		I.NUMAGENCIA AS 'BANCO AGÊNCIA', 
		K.DIGAG AS 'DIG AGÊNCIA', 
		I.NROCONTA AS CONTA, 
		L.DIGCONTA AS 'DIG CONTA', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			FXCX X (NOLOCK) 
			WHERE 
			X.CODCOLIGADA = 1 
			AND B.CODFILIAL = X.CODFILIAL 
			AND B.CODCXA = X.CODCXA 
			AND X.DATACOMPENSACAO >= (
				CASE WHEN B.CODFILIAL = 23 THEN '20231124' WHEN B.CODFILIAL = 27 THEN '20231124' WHEN B.CODFILIAL = 28 THEN '20231123' ELSE '${DATAINICIAL}' END
			) 
			AND X.DATACOMPENSACAO < '${DATAINICIAL}'
		) AS 'SALDO PERIODO ANTERIOR', 
		CASE WHEN A.CODTDO = '999' 
		AND (
			SELECT 
			TOP 1 CODTDO 
			FROM 
			FLAN (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDLAN IN (
				SELECT 
				IDLAN 
				FROM 
				FRELLAN (NOLOCK) 
				WHERE 
				CODCOLIGADA = 1 
				AND TIPOREL = 30 
				AND IDLANREL = A.IDLAN
			)
		) IN ('108', '109', '120', '138') THEN '40' WHEN A.CODTDO = '999' 
		AND (
			SELECT 
			TOP 1 CODTDO 
			FROM 
			FLAN (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDLAN IN (
				SELECT 
				IDLAN 
				FROM 
				FRELLAN (NOLOCK) 
				WHERE 
				CODCOLIGADA = 1 
				AND TIPOREL = 30 
				AND IDLANREL = A.IDLAN
			)
		) IN ('111') THEN '47' WHEN A.CODTDO = '999' 
		AND (
			SELECT 
			TOP 1 CODTDO 
			FROM 
			FLAN (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDLAN IN (
				SELECT 
				IDLAN 
				FROM 
				FRELLAN (NOLOCK) 
				WHERE 
				CODCOLIGADA = 1 
				AND TIPOREL = 30 
				AND IDLANREL = A.IDLAN
			)
		) IN ('016') THEN '50' WHEN A.CODTDO IN ('016', '108') THEN '31' WHEN A.CODTDO IN ('103', '010', '035', '043') THEN '9' ELSE ZO.OPERACAOID END 'OPERACAOID', 
		ZCL.CLASSPAGAMENTO AS 'CLASS. PAGAMENTO', 
		ZC.TIPOFORNECEDOR, 
		ZC.CLASSEFORNECEDOR, 
		CASE WHEN B.IDFORMAPAGTO = 1 THEN 6 WHEN B.IDFORMAPAGTO = 2 THEN 1 WHEN B.IDFORMAPAGTO IN (3, 4, 5, 6, 7) THEN (
			CASE WHEN FC.ESTSERV = '01' THEN 7 ELSE 19 END
		) ELSE 16 END AS 'DOCTIPOID', 
		B.IDXCX AS 'NOPERACAO', 
		CASE WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV ELSE A.NUMERODOCUMENTO END AS 'NDOCFIN', 
		FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'COMPETÊNCIA REFERENCIA', 
		FORMAT(B.DATABAIXA, 'dd/MM/yyyy') AS 'DATA', 
		B.VALORBAIXA AS 'VALOR', 
		A.SERIEDOCUMENTO AS 'SERIENF', 
		CASE WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV ELSE A.NUMERODOCUMENTO END AS 'NFDOC', 
		FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'DATANFDOC', 
		FORMAT(A.DATAVENCIMENTO, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA', 
		O.CODIGOCONTRATO AS 'NCONTRATO', 
		'' AS 'OBJETO CONTRATO', 
		O.NOME AS 'CONTRATO DESCRIÇÃO', 
		CASE WHEN P.CGCCFO IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE P.CGCCFO END AS 'CNPJ CONTRATO', 
		FORMAT(O.DATAINICIO, 'dd/MM/yyyy') AS 'CONTRATO INÍCIO VIGENCIA', 
		FORMAT(O.DATAFIM, 'dd/MM/yyyy') AS 'CONTRATO FIM VIGENCIA', 
		O.VALORCONTRATO AS 'VALOR CONTRATO', 
		(
			SELECT 
			ISNULL(
				SUM(X.VALORTOTAL), 
				0
			) 
			FROM 
			TITMCNT X (NOLOCK) 
			WHERE 
			X.IDCNT = NMP.IDCNT
		) AS 'VALOR PARC CONTRATO', 
		'' AS 'SERIE PARC CONTRATO', 
		CASE WHEN NMP.IDCNT IS NOT NULL THEN 'S' ELSE 'N' END 'POSSUI CONTRATO', 
		CASE WHEN A.CHAPA IS NOT NULL THEN PP.CPF WHEN P.CGCCFO IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE P.CGCCFO END AS 'CNPJ CPF PARTICIPANTE', 
		CASE WHEN A.CHAPA IS NOT NULL THEN PF.NOME ELSE P.NOMEFANTASIA END AS 'NOME PARTICIPANTE', 
		A.VALORORIGINAL AS 'VALOR DOC', 
		ISNULL(B.VALORMULTA, 0)+ ISNULL(B.VALORJUROS, 0) AS 'MULTAJUROS', 
		ISNULL(TM.VALORFRETE, 0) AS 'FRETE', 
		ISNULL(A.VALOROP2 + A.VALOROP6, 0) AS 'INSS', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			TTRBMOV (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDMOV = A.IDMOV 
			AND CODTRB = 'ICMSST'
		) AS 'ICMSST', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			TTRBMOV (NOLOCK) 
			WHERE 
			CODCOLIGADA = 1 
			AND IDMOV = A.IDMOV 
			AND CODTRB = 'IPI'
		) AS 'IPI', 
		ISNULL(A.VALOROP1, 0) AS 'ISS', 
		ISNULL(A.VALORIRRF + A.VALOROP7, 0) AS 'IR', 
		0 AS 'PIS', 
		0 AS 'COFINS', 
		0 AS 'CSLL', 
		ISNULL(R.VALOR, 0) AS 'CSRF', 
		CASE WHEN TM.VALORDESC > 0 THEN ISNULL(TM.VALORDESC, 0) ELSE ISNULL(B.VALORDESCONTO, 0) END AS 'DESCONTO', 
		CASE WHEN TM.CHAVEACESSONFE IS NULL THEN TM.CHAVEACESSONFE ELSE TM.CHAVEACESSONFE END AS 'CHAVE NF-E', 
		CASE WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '23'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 93/2023'
		) WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '27'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 92/2023'
		) WHEN (
			A.HISTORICO LIKE '%NF DE SERVIÇOS PRESTADOS%' 
			AND A.CODFILIAL = '28'
		) THEN REPLACE(
			A.HISTORICO, 'NF DE SERVIÇOS PRESTADOS', 
			'REPASSE REFERENTE AO CONTRATO DE GESTÃO 90/2023'
		) ELSE A.HISTORICO END AS 'HISTORICO', 
		CAST(T.HISTORICOCURTO AS VARCHAR) + CAST(T.HISTORICOLONGO AS VARCHAR) AS 'OBS DANFE', 
		'S' AS 'CONCILIADO', 
		'' AS 'ARQUIVO CERTIDÃO', 
		ISNULL(
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'MOVMOVIMENTODATA' 
				AND X.DESCRICAO LIKE 'CP%' 
				AND X.CHAVE = TM.IDMOV
			), 
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'FINLANDATABR' 
				AND X.DESCRICAO LIKE 'CP%' 
				AND X.CHAVE = A.IDLAN
			)
		) AS 'ARQUIVO NF', 
		'' AS 'ARQUIVO CONTRATO', 
		'' AS 'ARQUIVO XML', 
		'' AS 'CENTRO DE CUSTO', 
		'N' AS 'RETIFICADA', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTA CONTÁBIL GERAL', 
		'N' AS 'CONTRATO PARCELA VARIAVEL', 
		O.NOME AS 'CONTRATO DESCRICÃO SERVICO', 
		P.NOMEFANTASIA AS 'CONTRATO NOME FANTASIA', 
		ISNULL(
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'MOVMOVIMENTODATA' 
				AND X.DESCRICAO LIKE 'DOC%' 
				AND X.CHAVE = TM.IDMOV
			), 
			(
			SELECT 
				TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
				ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
				X.DATASERVER = 'FINLANDATABR' 
				AND X.DESCRICAO LIKE 'DOC%' 
				AND X.CHAVE = A.IDLAN
			)
		) AS 'ARQUIVO PESQUISA' 
		FROM 
		FLAN A (NOLOCK) 
		INNER JOIN FLANBAIXA B (NOLOCK) ON A.IDLAN = B.IDLAN 
		AND A.CODCOLIGADA = B.CODCOLIGADA 
		INNER JOIN COPERACAO C (NOLOCK) ON B.IDOPERACAO = C.IDOPERACAO 
		AND B.CODCOLIGADA = C.CODCOLIGADA 
		INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO 
		AND C.CODCOLIGADA = D.CODCOLIGADA 
		INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA 
		AND D.CODCOLIGADA = E.CODCOLIGADA 
		LEFT JOIN CCONTA H (NOLOCK) ON E.DEBITO = H.CODCONTA 
		AND E.CODCOLDEBITO = H.CODCOLIGADA 
		LEFT JOIN FCXA I (NOLOCK) ON B.CODCXA = I.CODCXA 
		AND B.CODCOLCXA = I.CODCOLPROP 
		LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO 
		LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO 
		AND I.NUMAGENCIA = K.NUMAGENCIA 
		LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA 
		AND I.NUMBANCO = L.NUMBANCO 
		AND I.NUMAGENCIA = L.NUMAGENCIA 
		LEFT JOIN TITMMOV N (NOLOCK) ON A.IDMOV = N.IDMOV 
		AND A.CODCOLIGADA = N.CODCOLIGADA 
		LEFT JOIN TMOV TM (NOLOCK) ON N.IDMOV = TM.IDMOV 
		AND N.CODCOLIGADA = TM.CODCOLIGADA 
		LEFT JOIN TMOVRELAC TMR (NOLOCK) ON TM.CODCOLIGADA = TMR.CODCOLDESTINO 
		AND TM.IDMOV = TMR.IDMOVDESTINO 
		LEFT JOIN TMOV TMP (NOLOCK) ON TMR.CODCOLORIGEM = TMP.CODCOLIGADA 
		AND TMP.IDMOV = TMR.IDMOVORIGEM 
		LEFT JOIN TITMMOV NMP (NOLOCK) ON TMP.CODCOLIGADA = NMP.CODCOLIGADA 
		AND TMP.IDMOV = NMP.IDMOV 
		AND NMP.NSEQITMMOV = 1 
		LEFT JOIN TCNT O (NOLOCK) ON NMP.IDCNT = O.IDCNT 
		AND NMP.CODCOLIGADA = O.CODCOLIGADA 
		AND NMP.CODFILIAL = O.CODFILIAL 
		AND TMP.CODCFO = O.CODCFO 
		LEFT JOIN FCFO P (NOLOCK) ON A.CODCFO = P.CODCFO 
		AND A.CODCOLCFO = P.CODCOLIGADA 
		LEFT JOIN GFILIAL Q (NOLOCK) ON A.CODFILIAL = Q.CODFILIAL 
		AND A.CODCOLIGADA = Q.CODCOLIGADA 
		LEFT JOIN FTRBLAN R (NOLOCK) ON A.IDLAN = R.IDLAN 
		AND A.CODCOLIGADA = R.CODCOLIGADA 
		LEFT JOIN TNFEENTRADA S (NOLOCK) ON TM.IDMOV = S.IDMOV 
		AND TM.CODCOLIGADA = S.CODCOLIGADA 
		LEFT JOIN TMOVHISTORICO T (NOLOCK) ON TM.IDMOV = T.IDMOV 
		AND TM.CODCOLIGADA = T.CODCOLIGADA 
		LEFT JOIN ZOPERACAOID_ENTRADAS ZO ON A.CODTB5FLX = ZO.CODTB5FLX 
		AND A.CODCOLIGADA = 1 
		LEFT JOIN FCFOCOMPL FC (NOLOCK) ON A.CODCFO = FC.CODCFO 
		AND A.CODCOLCFO = FC.CODCOLIGADA 
		LEFT JOIN ZCLASSPAGAMENTO ZCL ON A.CODTB3FLX = ZCL.CODTB3FLX 
		LEFT JOIN ZCLASSEFORNECEDOR2 ZC ON A.CODTB3FLX = ZC.CODTB3FLX 
		AND A.CODCOLIGADA = ZC.CODCOLIGADA 
		LEFT JOIN PFUNC PF (NOLOCK) ON A.CHAPA = PF.CHAPA 
		LEFT JOIN PPESSOA PP (NOLOCK) ON PF.CODPESSOA = PP.CODIGO 
		WHERE 
		A.CODCOLIGADA = 1 
		AND A.CODFILIAL = ${CODFILIAL} 
		AND B.DATABAIXA >= '${DATAINICIAL}' 
		AND B.DATABAIXA <= '${DATAFINAL}' 
		AND A.PAGREC = 1 
		AND B.STATUS <> 1 
		AND A.STATUSLAN <> 2 
		AND A.NFOUDUP <> 1 
		AND E.DEBITO LIKE '1.1.1%' 
		UNION 
		SELECT 
		DISTINCT '0200' AS 'REG', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTACONTABIL', 
		I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA', 
		I.NUMBANCO AS 'CODIGO BANCO', 
		J.NOME AS 'NOME BANCO', 
		I.NUMAGENCIA AS 'BANCO AGÊNCIA', 
		K.DIGAG AS 'DIG AGÊNCIA', 
		I.NROCONTA AS 'CONTA', 
		L.DIGCONTA AS 'DIG CONTA', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			FXCX X (NOLOCK) 
			WHERE 
			X.CODCOLIGADA = 1 
			AND A.CODFILIAL = X.CODFILIAL 
			AND A.CODCXA = X.CODCXA 
			AND X.DATACOMPENSACAO >= (
				CASE WHEN A.CODFILIAL = 23 THEN '20231124' WHEN A.CODFILIAL = 27 THEN '20231124' WHEN A.CODFILIAL = 28 THEN '20231123' ELSE '${DATAINICIAL}' END
			) 
			AND X.DATACOMPENSACAO < '${DATAINICIAL}'
		) AS 'SALDO PERIODO ANTERIOR', 
		CASE WHEN A.TIPO = 3 
		AND LEN(I.CODCXA)= 9 
		AND (
			(
			SELECT 
				LEN(CODCXATRANSF) 
			FROM 
				FXCX 
			WHERE 
				IDXCX = A.IDXCX
			)
		) <> 9 
		AND A.HISTORICO LIKE 'RESGAT%' THEN 3 --14 SAINDO DA CONTA DE APLICAÇÃO PARA CONTA CORRENTE
		WHEN A.TIPO = 3 
		AND LEN(I.CODCXA)= 9 
		AND (
			(
			SELECT 
				LEN(CODCXATRANSF) 
			FROM 
				FXCX 
			WHERE 
				IDXCX = A.IDXCX
			)
		) <> 9 
		AND A.HISTORICO LIKE 'APLICA%' THEN 3 --12 SAINDO DA CONTA DE APLICAÇÃO PARA CONTA CORRENTE
		WHEN A.TIPO = 3 
		AND LEN(I.CODCXA)<> 9 
		AND (
			(
			SELECT 
				LEN(CODCXATRANSF) 
			FROM 
				FXCX 
			WHERE 
				IDXCX = A.IDXCX
			)
		) = 9 
		AND A.HISTORICO LIKE 'RESGAT%' THEN 11 --SAINDO DA CONTA CORRENTE PARA CONTA DE APLICAÇÃO
		WHEN A.TIPO = 3 
		AND LEN(I.CODCXA)<> 9 
		AND (
			(
			SELECT 
				LEN(CODCXATRANSF) 
			FROM 
				FXCX 
			WHERE 
				IDXCX = A.IDXCX
			)
		) = 9 
		AND A.HISTORICO LIKE 'APLICA%' THEN 11 --SAINDO DA CONTA CORRENTE PARA CONTA DE APLICAÇÃO
		WHEN A.TIPO = 3 
		AND LEN(I.CODCXA)<> 9 
		AND (
			(
			SELECT 
				LEN(CODCXATRANSF) 
			FROM 
				FXCX 
			WHERE 
				IDXCX = A.IDXCX
			)
		) <> 9 
		AND (
			A.HISTORICO NOT LIKE 'APLICA%' 
			AND A.HISTORICO NOT LIKE 'RESGAT%'
		) THEN 15 --SAINDO DA CONTA CORRENTE PARA OUTRA CONTA CORRENTE
		ELSE ZO.OPERACAOID END AS 'OPERACAOID', 
		NULL AS 'CLASS. PAGAMENTO', 
		ZC.TIPOFORNECEDOR, 
		NULL AS 'CLASS.FORNECEDOR', 
		CASE WHEN A.CODTB3FLX = '06.01.01.001' THEN 13 ELSE 16 END 'DOCTIPOID', 
		A.IDXCX AS 'NOPERACAO', 
		A.NUMERODOCUMENTO AS 'NDOCFIN', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'COMPETÊNCIA REFERENCIA', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATA', 
		ABS(A.VALOR) AS 'VALOR', 
		NULL AS 'SERIENF', 
		A.NUMERODOCUMENTO AS 'NFDOC', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATANFDOC', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA', 
		NULL AS 'NCONTRATO', 
		NULL AS 'OBJETO CONTRATO', 
		NULL AS 'CONTRATO DESCRIÇÃO', 
		NULL AS 'CNPJ CONTRATO', 
		NULL AS 'CONTRATO INÍCIO VIGENCIA', 
		NULL AS 'CONTRATO FIM VIGENCIA', 
		0 AS 'VALOR CONTRATO', 
		0 AS 'VALOR PARC CONTRATO', 
		NULL AS 'SERIE PARC CONTRATO', 
		'N' AS 'POSSUI CONTRATO', 
		CASE WHEN B.CGC IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE B.CGC END AS 'CNPJ CPF PARTICIPANTE', 
		B.NOMEFANTASIA AS 'NOME PARTICIPANTE', 
		ABS(A.VALOR) AS 'VALOR DOC', 
		0 AS 'MULTAJUROS', 
		0 AS 'FRETE', 
		0 AS 'INSS', 
		0 AS 'ICMSST', 
		0 AS 'IPI', 
		0 AS 'ISS', 
		0 AS 'IR', 
		0 AS 'PIS', 
		0 AS 'COFINS', 
		0 AS 'CSLL', 
		0 AS 'CSRF', 
		0 AS 'DESCONTO', 
		0 AS 'CHAVE NF-E', 
		A.HISTORICO AS 'HISTORICO', 
		NULL AS 'OBS DANFE', 
		'S' AS 'CONCILIADO', 
		'' AS 'ARQUIVO CERTIDÃO', 
		(
			SELECT 
			TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
			ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
			X.DATASERVER = 'FINXCXDATA' 
			AND X.CHAVE = A.IDXCX
		) AS 'ARQUIVO NF', 
		NULL AS 'ARQUIVO CONTRATO', 
		NULL AS 'ARQUIVO XML', 
		NULL AS 'CENTRO DE CUSTO', 
		'N' AS 'RETIFICADA', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTA CONTÁBIL GERAL', 
		'N' AS 'CONTRATO PARCELA VARIAVEL', 
		NULL AS 'CONTRATO DESCRICÃO SERVICO', 
		NULL AS 'CONTRATO NOME FANTASIA', 
		(
			SELECT 
			TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
			ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
			X.DATASERVER = 'FINLANDATABR' 
			AND X.DESCRICAO LIKE 'DOC%' 
			AND X.CHAVE = A.IDLAN
		) AS 'ARQUIVOPESQUISA' 
		FROM 
		FXCX A (NOLOCK) 
		INNER JOIN GFILIAL B (NOLOCK) ON A.CODCOLIGADA = B.CODCOLIGADA 
		AND A.CODFILIAL = B.CODFILIAL 
		INNER JOIN COPERACAO C (NOLOCK) ON A.IDOPERACAOCONT = C.IDOPERACAO 
		AND A.CODCOLIGADA = C.CODCOLIGADA 
		INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO 
		AND C.CODCOLIGADA = D.CODCOLIGADA 
		INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA 
		AND D.CODCOLIGADA = E.CODCOLIGADA 
		LEFT JOIN CCONTA H (NOLOCK) ON E.CREDITO = H.CODCONTA 
		AND E.CODCOLCREDITO = H.CODCOLIGADA 
		LEFT JOIN FCXA I (NOLOCK) ON A.CODCXA = I.CODCXA 
		AND A.CODCOLCXA = I.CODCOLPROP 
		LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO 
		LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO 
		AND I.NUMAGENCIA = K.NUMAGENCIA 
		LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA 
		AND I.NUMBANCO = L.NUMBANCO 
		AND I.NUMAGENCIA = L.NUMAGENCIA 
		LEFT JOIN ZOPERACAOID_SAIDAS ZO ON A.CODTB3FLX = ZO.CODTB3FLX 
		AND A.CODCOLIGADA = 1 
		LEFT JOIN ZCLASSPAGAMENTO ZCL ON A.CODTB3FLX = ZCL.CODTB3FLX 
		LEFT JOIN ZCLASSEFORNECEDOR2 ZC ON A.CODTB3FLX = ZC.CODTB3FLX 
		AND A.CODCOLIGADA = ZC.CODCOLIGADA 
		WHERE 
		A.CODCOLIGADA = 1 
		AND A.CODFILIAL = ${CODFILIAL} 
		AND A.TIPO IN(1, 3) 
		AND A.DATA >= '${DATAINICIAL}' 
		AND A.DATA <= '${DATAFINAL}' 
		AND E.CREDITO LIKE '1.1.1%' 
		AND A.COMPENSADO <> 2 
		UNION 
		SELECT 
		DISTINCT '0200' AS 'REG', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTACONTABIL', 
		I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA', 
		I.NUMBANCO AS 'CODIGO BANCO', 
		J.NOME AS 'NOME BANCO', 
		I.NUMAGENCIA AS 'BANCO AGÊNCIA', 
		K.DIGAG AS 'DIG AGÊNCIA', 
		I.NROCONTA AS 'CONTA', 
		L.DIGCONTA AS 'DIG CONTA', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			FXCX X (NOLOCK) 
			WHERE 
			X.CODCOLIGADA = 1 
			AND A.CODFILIAL = X.CODFILIAL 
			AND A.CODCXA = X.CODCXA 
			AND X.DATACOMPENSACAO >= (
				CASE WHEN A.CODFILIAL = 23 THEN '20231124' WHEN A.CODFILIAL = 27 THEN '20231124' WHEN A.CODFILIAL = 28 THEN '20231123' ELSE '${DATAINICIAL}' END
			) 
			AND X.DATACOMPENSACAO < '${DATAINICIAL}'
		) AS 'SALDO PERIODO ANTERIOR', 
		ZO.OPERACAOID, 
		NULL AS 'CLASS. PAGAMENTO', 
		ZC.TIPOFORNECEDOR, 
		NULL AS 'CLASS.FORNECEDOR', 
		CASE WHEN A.CODTB3FLX = '06.01.01.001' THEN 13 ELSE 16 END 'DOCTIPOID', 
		A.IDXCX AS 'NOPERACAO', 
		A.NUMERODOCUMENTO AS 'NDOCFIN', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'COMPETÊNCIA REFERENCIA', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATA', 
		ABS(A.VALOR) AS 'VALOR', 
		NULL AS 'SERIENF', 
		A.NUMERODOCUMENTO AS 'NFDOC', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATANFDOC', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA', 
		NULL AS 'NCONTRATO', 
		NULL AS 'OBJETO CONTRATO', 
		NULL AS 'CONTRATO DESCRIÇÃO', 
		NULL AS 'CNPJ CONTRATO', 
		NULL AS 'CONTRATO INÍCIO VIGENCIA', 
		NULL AS 'CONTRATO FIM VIGENCIA', 
		0 AS 'VALOR CONTRATO', 
		0 AS 'VALOR PARC CONTRATO', 
		NULL AS 'SERIE PARC CONTRATO', 
		'N' AS 'POSSUI CONTRATO', 
		CASE WHEN B.CGC IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE B.CGC END AS 'CNPJ CPF PARTICIPANTE', 
		B.NOMEFANTASIA AS 'NOME PARTICIPANTE', 
		ABS(A.VALOR) AS 'VALOR DOC', 
		0 AS 'MULTAJUROS', 
		0 AS 'FRETE', 
		0 AS 'INSS', 
		0 AS 'ICMSST', 
		0 AS 'IPI', 
		0 AS 'ISS', 
		0 AS 'IR', 
		0 AS 'PIS', 
		0 AS 'COFINS', 
		0 AS 'CSLL', 
		0 AS 'CSRF', 
		0 AS 'DESCONTO', 
		0 AS 'CHAVE NF-E', 
		A.HISTORICO AS 'HISTORICO', 
		NULL AS 'OBS DANFE', 
		'S' AS 'CONCILIADO', 
		'' AS 'ARQUIVO CERTIDÃO', 
		(
			SELECT 
			TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
			ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
			X.DATASERVER = 'FINXCXDATA' 
			AND X.CHAVE = A.IDXCX
		) AS 'ARQUIVO NF', 
		NULL AS 'ARQUIVO CONTRATO', 
		NULL AS 'ARQUIVO XML', 
		NULL AS 'CENTRO DE CUSTO', 
		'N' AS 'RETIFICADA', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTA CONTÁBIL GERAL', 
		'N' AS 'CONTRATO PARCELA VARIAVEL', 
		NULL AS 'CONTRATO DESCRICÃO SERVICO', 
		NULL AS 'CONTRATO NOME FANTASIA', 
		(
			SELECT 
			TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
			ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
			X.DATASERVER = 'FINLANDATABR' 
			AND X.DESCRICAO LIKE 'DOC%' 
			AND X.CHAVE = A.IDLAN
		) AS 'ARQUIVOPESQUISA' 
		FROM 
		FXCX A (NOLOCK) 
		INNER JOIN GFILIAL B (NOLOCK) ON A.CODCOLIGADA = B.CODCOLIGADA 
		AND A.CODFILIAL = B.CODFILIAL 
		INNER JOIN COPERACAO C (NOLOCK) ON A.IDOPERACAOCONT = C.IDOPERACAO 
		AND A.CODCOLIGADA = C.CODCOLIGADA 
		INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO 
		AND C.CODCOLIGADA = D.CODCOLIGADA 
		INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA 
		AND D.CODCOLIGADA = E.CODCOLIGADA 
		LEFT JOIN CCONTA H (NOLOCK) ON E.DEBITO = H.CODCONTA 
		AND E.CODCOLDEBITO = H.CODCOLIGADA 
		LEFT JOIN FCXA I (NOLOCK) ON A.CODCXA = I.CODCXA 
		AND A.CODCOLCXA = I.CODCOLPROP 
		LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO 
		LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO 
		AND I.NUMAGENCIA = K.NUMAGENCIA 
		LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA 
		AND I.NUMBANCO = L.NUMBANCO 
		AND I.NUMAGENCIA = L.NUMAGENCIA 
		LEFT JOIN ZOPERACAOID_ENTRADAS ZO ON A.CODTB5FLX = ZO.CODTB5FLX 
		AND A.CODCOLIGADA = 1 
		LEFT JOIN ZCLASSPAGAMENTO ZCL ON A.CODTB3FLX = ZCL.CODTB3FLX 
		LEFT JOIN ZCLASSEFORNECEDOR2 ZC ON A.CODTB3FLX = ZC.CODTB3FLX 
		AND A.CODCOLIGADA = ZC.CODCOLIGADA 
		WHERE 
		A.CODCOLIGADA = 1 
		AND A.CODFILIAL = ${CODFILIAL} 
		AND A.TIPO = 2 
		AND A.DATA >= '${DATAINICIAL}' 
		AND A.DATA <= '${DATAFINAL}' 
		AND E.DEBITO LIKE '1.1.1%' 
		AND A.COMPENSADO <> 2 
		UNION 
		SELECT 
		DISTINCT '0200' AS 'REG', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = IC.CODCONTA
		) AS 'CONTACONTABIL', 
		I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA', 
		I.NUMBANCO AS 'CODIGO BANCO', 
		J.NOME AS 'NOME BANCO', 
		I.NUMAGENCIA AS 'BANCO AGÊNCIA', 
		K.DIGAG AS 'DIG AGÊNCIA', 
		I.NROCONTA AS 'CONTA', 
		L.DIGCONTA AS 'DIG CONTA', 
		(
			SELECT 
			ISNULL(
				SUM(VALOR), 
				0
			) 
			FROM 
			FXCX X (NOLOCK) 
			WHERE 
			X.CODCOLIGADA = 1 
			AND A.CODFILIAL = X.CODFILIAL 
			AND A.CODCXA = X.CODCXA 
			AND X.DATACOMPENSACAO >= (
				CASE WHEN A.CODFILIAL = 23 THEN '20231124' WHEN A.CODFILIAL = 27 THEN '20231124' WHEN A.CODFILIAL = 28 THEN '20231123' ELSE '${DATAINICIAL}' END
			) 
			AND X.DATACOMPENSACAO < '${DATAINICIAL}'
		) AS 'SALDO PERIODO ANTERIOR', 
		CASE WHEN LEN(I.CODCXA)= 9 
		AND (
			(
			SELECT 
				LEN(CODCXA) 
			FROM 
				FXCX (NOLOCK) 
			WHERE 
				CODCOLIGADA = 1 
				AND IDXCXTRANSF = (
				SELECT 
					IDXCX 
				FROM 
					FXCX (NOLOCK) 
				WHERE 
					CODCOLIGADA = 1 
					AND IDXCX = A.IDXCX
				)
			)
		) <> 9 
		AND A.HISTORICO LIKE 'RESGAT%' THEN 12 --ENTRANDO NA CONTA DE APLICAÇÃO
		WHEN LEN(I.CODCXA)= 9 
		AND (
			(
			SELECT 
				LEN(CODCXA) 
			FROM 
				FXCX (NOLOCK) 
			WHERE 
				CODCOLIGADA = 1 
				AND IDXCXTRANSF = (
				SELECT 
					IDXCX 
				FROM 
					FXCX (NOLOCK) 
				WHERE 
					CODCOLIGADA = 1 
					AND IDXCX = A.IDXCX
				)
			)
		) <> 9 
		AND A.HISTORICO LIKE 'APLIC%' THEN 12 --ENTRANDO NA CONTA DE APLICAÇÃO 
		WHEN LEN(I.CODCXA)<> 9 
		AND (
			(
			SELECT 
				LEN(CODCXA) 
			FROM 
				FXCX (NOLOCK) 
			WHERE 
				CODCOLIGADA = 1 
				AND IDXCXTRANSF = (
				SELECT 
					IDXCX 
				FROM 
					FXCX (NOLOCK) 
				WHERE 
					CODCOLIGADA = 1 
					AND IDXCX = A.IDXCX
				)
			)
		) = 9 THEN 14 --ENTRANDO EM CONTA CORRENTE ORIGEM CONTA APLICAÇÃO
		WHEN LEN(I.CODCXA)<> 9 
		AND (
			(
			SELECT 
				LEN(CODCXA) 
			FROM 
				FXCX (NOLOCK) 
			WHERE 
				CODCOLIGADA = 1 
				AND IDXCXTRANSF = (
				SELECT 
					IDXCX 
				FROM 
					FXCX (NOLOCK) 
				WHERE 
					CODCOLIGADA = 1 
					AND IDXCX = A.IDXCX
				)
			)
		) <> 9 THEN 16 --ENTRANDO EM CONTA CORRENTE ORIEM CONTA CORRENTE
		ELSE ZO.OPERACAOID END AS OPERACAOID, 
		NULL AS 'CLASS. PAGAMENTO', 
		ZC.TIPOFORNECEDOR, 
		NULL AS 'CLASS.FORNECEDOR', 
		CASE WHEN A.CODTB3FLX = '06.01.01.001' THEN 13 ELSE 16 END 'DOCTIPOID', 
		A.IDXCX AS 'NOPERACAO', 
		A.NUMERODOCUMENTO AS 'NDOCFIN', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'COMPETÊNCIA REFERENCIA', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATA', 
		ABS(A.VALOR) AS 'VALOR', 
		NULL AS 'SERIENF', 
		A.NUMERODOCUMENTO AS 'NFDOC', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATANFDOC', 
		FORMAT(A.DATA, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA', 
		NULL AS 'NCONTRATO', 
		NULL AS 'OBJETO CONTRATO', 
		NULL AS 'CONTRATO DESCRIÇÃO', 
		NULL AS 'CNPJ CONTRATO', 
		NULL AS 'CONTRATO INÍCIO VIGENCIA', 
		NULL AS 'CONTRATO FIM VIGENCIA', 
		0 AS 'VALOR CONTRATO', 
		0 AS 'VALOR PARC CONTRATO', 
		NULL AS 'SERIE PARC CONTRATO', 
		'N' AS 'POSSUI CONTRATO', 
		CASE WHEN B.CGC IN(
			'21.583.042/0023-88', '21.583.042/0027-01', 
			'21.583.042/0028-92'
		) THEN '21.583.042/0001-72' ELSE B.CGC END AS 'CNPJ CPF PARTICIPANTE', 
		B.NOMEFANTASIA AS 'NOME PARTICIPANTE', 
		ABS(A.VALOR) AS 'VALOR DOC', 
		0 AS 'MULTAJUROS', 
		0 AS 'FRETE', 
		0 AS 'INSS', 
		0 AS 'ICMSST', 
		0 AS 'IPI', 
		0 AS 'ISS', 
		0 AS 'IR', 
		0 AS 'PIS', 
		0 AS 'COFINS', 
		0 AS 'CSLL', 
		0 AS 'CSRF', 
		0 AS 'DESCONTO', 
		0 AS 'CHAVE NF-E', 
		A.HISTORICO AS 'HISTORICO', 
		NULL AS 'OBS DANFE', 
		'S' AS 'CONCILIADO', 
		'' AS 'ARQUIVO CERTIDÃO', 
		(
			SELECT 
			TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
			ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
			X.DATASERVER = 'FINXCXDATA' 
			AND X.CHAVE = A.IDXCX
		) AS 'ARQUIVO NF', 
		NULL AS 'ARQUIVO CONTRATO', 
		NULL AS 'ARQUIVO XML', 
		NULL AS 'CENTRO DE CUSTO', 
		'N' AS 'RETIFICADA', 
		(
			SELECT 
			CODCONTA2 
			FROM 
			CCTACTA2 (NOLOCK) 
			WHERE 
			CODPARALELO = (
				CASE WHEN ${CODFILIAL} = 28 THEN 80 WHEN ${CODFILIAL} = 23 THEN 81 WHEN ${CODFILIAL} = 27 THEN 82 ELSE 0 END
			) 
			AND CODCONTA = H.CODCONTA
		) AS 'CONTA CONTÁBIL GERAL', 
		'N' AS 'CONTRATO PARCELA VARIAVEL', 
		NULL AS 'CONTRATO DESCRICÃO SERVICO', 
		NULL AS 'CONTRATO NOME FANTASIA', 
		(
			SELECT 
			TOP 1 CASE WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ' ELSE X.CODDOCUMENTO END 
			FROM 
			ZHCINTEGRACAOGED X (NOLOCK) 
			WHERE 
			X.DATASERVER = 'FINLANDATABR' 
			AND X.DESCRICAO LIKE 'DOC%' 
			AND X.CHAVE = A.IDLAN
		) AS 'ARQUIVOPESQUISA' 
		FROM 
		FXCX A (NOLOCK) 
		INNER JOIN GFILIAL B (NOLOCK) ON A.CODCOLIGADA = B.CODCOLIGADA 
		AND A.CODFILIAL = B.CODFILIAL 
		LEFT JOIN COPERACAO C (NOLOCK) ON A.IDOPERACAOCONT = C.IDOPERACAO 
		AND A.CODCOLIGADA = C.CODCOLIGADA 
		LEFT JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO 
		AND C.CODCOLIGADA = D.CODCOLIGADA 
		LEFT JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA 
		AND D.CODCOLIGADA = E.CODCOLIGADA 
		AND E.DEBITO LIKE '1.1.1%' 
		LEFT JOIN CCONTA H (NOLOCK) ON E.DEBITO = H.CODCONTA 
		AND E.CODCOLDEBITO = H.CODCOLIGADA 
		LEFT JOIN FCXA I (NOLOCK) ON A.CODCXA = I.CODCXA 
		AND A.CODCOLCXA = I.CODCOLPROP 
		LEFT JOIN FCXACONT IC (NOLOCK) ON I.CODCOLIGADA = IC.CODCOLIGADA 
		AND I.CODCXA = IC.CODCXA 
		AND IC.CODCONTA LIKE '1.1.1%' 
		LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO 
		LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO 
		AND I.NUMAGENCIA = K.NUMAGENCIA 
		LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA 
		AND I.NUMBANCO = L.NUMBANCO 
		AND I.NUMAGENCIA = L.NUMAGENCIA 
		LEFT JOIN ZOPERACAOID_ENTRADAS ZO ON A.CODTB5FLX = ZO.CODTB5FLX 
		AND A.CODCOLIGADA = 1 
		LEFT JOIN ZCLASSPAGAMENTO ZCL ON A.CODTB3FLX = ZCL.CODTB3FLX 
		LEFT JOIN ZCLASSEFORNECEDOR2 ZC ON A.CODTB3FLX = ZC.CODTB3FLX 
		AND A.CODCOLIGADA = ZC.CODCOLIGADA 
		WHERE 
		A.CODCOLIGADA = 1 
		AND A.TIPO = 4 
		AND A.COMPENSADO <> 2 
		AND A.CODFILIAL = ${CODFILIAL} 
		AND A.DATA >= '${DATAINICIAL}' 
		AND A.DATA <= '${DATAFINAL}'
	`
	return sql;
}

const sqlSipef_nova = (CODFILIAL, DATAINICIAL, DATAFINAL) => {
	const sql = `
	USE ${db};
	USE CorporeRM;
SELECT DISTINCT '0200' AS 'REG',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = b.codfilial
                        and pca.codconta = ic.codconta
        ) AS 'CONTACONTABIL',
        I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA',
        I.NUMBANCO AS 'CODIGO BANCO',
        J.NOME AS 'NOME BANCO',
        I.NUMAGENCIA AS 'BANCO AGNCIA',
        K.DIGAG AS 'DIG AGNCIA',
        I.NROCONTA AS CONTA,
        L.DIGCONTA AS 'DIG CONTA',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM FXCX X (NOLOCK)
                WHERE X.CODCOLIGADA = 1
                        AND B.CODFILIAL = X.CODFILIAL
                        AND B.CODCXA = X.CODCXA
                        AND X.DATACOMPENSACAO >= (
                                CASE
                                        WHEN B.CODFILIAL = 23 THEN '20231124'
                                        WHEN B.CODFILIAL = 27 THEN '20231124'
                                        WHEN B.CODFILIAL = 28 THEN '20231123'
                                        ELSE '${DATAINICIAL}'
                                END
                        )
                        AND X.DATACOMPENSACAO < '${DATAINICIAL}'
        ) AS 'SALDO PERIODO ANTERIOR',
        CASE
                WHEN A.CODTDO IN ('016', '108') THEN '31'
                WHEN A.CODTDO IN ('103', '010', '035', '043') THEN '9'
                WHEN A.CODTDO IN ('036', '052', '129') THEN 50
                ELSE ZO.OPERACAOID
        END AS 'OPERACAOID',
        ZCL.CLASSPAGAMENTO AS 'CLASS. PAGAMENTO',
        ZC.TIPOFORNECEDOR,
        ZC.CLASSEFORNECEDOR,
        CASE
                WHEN B.IDFORMAPAGTO = 1 THEN 6
                WHEN B.IDFORMAPAGTO = 2 THEN 1
                WHEN B.IDFORMAPAGTO IN (3, 4, 5, 6, 7) THEN (
                        CASE
                                WHEN FC.ESTSERV = '01' THEN 7
                                ELSE 19
                        END
                )
                ELSE 16
        END AS 'DOCTIPOID',
        B.IDBAIXA AS 'NOPERACAO',
        CASE
                WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV
                ELSE A.NUMERODOCUMENTO
        END AS 'NDOCFIN',
        FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'COMPETNCIA REFERENCIA',
        FORMAT(B.DATABAIXA, 'dd/MM/yyyy') AS 'DATA',
        B.VALORBAIXA AS 'VALOR',
        A.SERIEDOCUMENTO AS 'SERIENF',
        CASE
                WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV
                ELSE A.NUMERODOCUMENTO
        END AS 'NFDOC',
        FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'DATANFDOC',
        FORMAT(A.DATAVENCIMENTO, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA',
        O.CODIGOCONTRATO AS 'NCONTRATO',
        CASE
                WHEN P.CODCFO = '026614' THEN 'SUBVENO'
                ELSE OC.SERVCONTRA
        END AS 'OBJETOCONTRATO',
        O.NOME AS 'CONTRATO DESCRIO',
        CASE
                WHEN P.CGCCFO IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE P.CGCCFO
        END AS 'CNPJ CONTRATO',
        FORMAT(O.DATAINICIO, 'dd/MM/yyyy') AS 'CONTRATO INCIO VIGENCIA',
        FORMAT(O.DATAFIM, 'dd/MM/yyyy') AS 'CONTRATO FIM VIGENCIA',
        O.VALORCONTRATO AS 'VALOR CONTRATO',
        (
                SELECT ISNULL(SUM(X.VALORTOTAL), 0)
                FROM TITMCNT X (NOLOCK)
                WHERE X.IDCNT = ISNULL(NMP.IDCNT, N.IDCNT)
        ) AS 'VALOR PARC CONTRATO',
        '' AS 'SERIE PARC CONTRATO',
        CASE
                WHEN ISNULL(NMP.IDCNT, N.IDCNT) IS NOT NULL THEN 'S'
                ELSE 'N'
        END 'POSSUI CONTRATO',
        CASE
                WHEN A.CHAPA IS NOT NULL THEN PP.CPF
                WHEN P.CGCCFO IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92'
                ) THEN '21.583.042/0001-72'
                ELSE P.CGCCFO
        END AS 'CNPJ CPF PARTICIPANTE',
        CASE
                WHEN A.CHAPA IS NOT NULL THEN PF.NOME
                ELSE P.NOMEFANTASIA
        END AS 'NOME PARTICIPANTE',
        A.VALORORIGINAL AS 'VALOR DOC',
        ISNULL(B.VALORMULTA, 0) + ISNULL(B.VALORJUROS, 0) AS 'MULTAJUROS',
        ISNULL(TM.VALORFRETE, 0) AS 'FRETE',
        ISNULL(A.VALOROP2 + A.VALOROP6, 0) AS 'INSS',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM TTRBMOV (NOLOCK)
                WHERE CODCOLIGADA = 1
                        AND IDMOV = A.IDMOV
                        AND CODTRB = 'ICMSST'
        ) AS 'ICMSST',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM TTRBMOV (NOLOCK)
                WHERE CODCOLIGADA = 1
                        AND IDMOV = A.IDMOV
                        AND CODTRB = 'IPI'
        ) AS 'IPI',
        ISNULL(A.VALOROP1, 0) AS 'ISS',
        ISNULL(A.VALORIRRF + A.VALOROP7, 0) AS 'IR',
        0 AS 'PIS',
        0 AS 'COFINS',
        0 AS 'CSLL',
        ISNULL(R.VALOR, 0) AS 'CSRF',
        CASE
                WHEN TM.VALORDESC > 0 THEN ISNULL(TM.VALORDESC, 0)
                ELSE ISNULL(B.VALORDESCONTO, 0)
        END AS 'DESCONTO',
        CASE
                WHEN TM.CHAVEACESSONFE IS NULL THEN TM.CHAVEACESSONFE
                ELSE TM.CHAVEACESSONFE
        END AS 'CHAVE NF-E',
        CASE
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '23'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 93/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '27'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 92/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '28'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 90/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '29'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 08/2024'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '30'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 33/2024'
                )
                ELSE A.HISTORICO
        END AS 'HISTORICO',
        CAST(T.HISTORICOCURTO AS VARCHAR) + CAST(T.HISTORICOLONGO AS VARCHAR) AS 'OBS DANFE',
        'S' AS 'CONCILIADO',
        '' AS 'ARQUIVO CERTIDAO',
        ISNULL(
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'MOVMOVIMENTODATA'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'CP%'
                                AND X.CHAVE = TM.IDMOV
                ),
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'FINLANDATABR'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'CP%'
                                AND X.CHAVE = A.IDLAN
                )
        ) AS 'ARQUIVO NF',
        '' AS 'ARQUIVO CONTRATO',
        '' AS 'ARQUIVO XML',
        '' AS 'CENTRO DE CUSTO',
        'N' AS 'RETIFICADA',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = b.codfilial
                        and pca.codconta = ic.codconta
        ) AS 'CONTA CONTBIL GERAL',
        'N' AS 'CONTRATO PARCELA VARIAVEL',
        O.NOME AS 'CONTRATO DESCRICAO SERVICO',
        P.NOMEFANTASIA AS 'CONTRATO NOME FANTASIA',
        ISNULL(
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'MOVMOVIMENTODATA'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'DOC%'
                                AND X.CHAVE = TM.IDMOV
                ),
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'FINLANDATABR'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'DOC%'
                                AND X.CHAVE = A.IDLAN
                )
        ) AS 'ARQUIVO PESQUISA'
FROM FLAN A (NOLOCK)
        INNER JOIN FLANBAIXA B (NOLOCK) ON A.IDLAN = B.IDLAN
        AND A.CODCOLIGADA = B.CODCOLIGADA
        LEFT JOIN FCXA I (NOLOCK) ON B.CODCXA = I.CODCXA
        AND B.CODCOLCXA = I.CODCOLPROP
        LEFT JOIN FCXACONT IC (NOLOCK) ON I.CODCOLIGADA = IC.CODCOLIGADA
        AND I.CODCXA = IC.CODCXA
        AND IC.TIPO = 1
        LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO
        LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO
        AND I.NUMAGENCIA = K.NUMAGENCIA
        LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA
        AND I.NUMBANCO = L.NUMBANCO
        AND I.NUMAGENCIA = L.NUMAGENCIA
        LEFT JOIN TITMMOV N (NOLOCK) ON A.IDMOV = N.IDMOV
        AND A.CODCOLIGADA = N.CODCOLIGADA
        LEFT JOIN TMOV TM (NOLOCK) ON N.IDMOV = TM.IDMOV
        AND N.CODCOLIGADA = TM.CODCOLIGADA
        LEFT JOIN TMOVRELAC TMR (NOLOCK) ON TM.CODCOLIGADA = TMR.CODCOLDESTINO
        AND TM.IDMOV = TMR.IDMOVDESTINO
        LEFT JOIN TMOV TMP (NOLOCK) ON TMR.CODCOLORIGEM = TMP.CODCOLIGADA
        AND TMP.IDMOV = TMR.IDMOVORIGEM
        LEFT JOIN TITMMOV NMP (NOLOCK) ON TMP.CODCOLIGADA = NMP.CODCOLIGADA
        AND TMP.IDMOV = NMP.IDMOV
        AND NMP.NSEQITMMOV = 1
        LEFT JOIN TCNT O (NOLOCK) ON ISNULL(NMP.IDCNT, N.IDCNT) = O.IDCNT
        AND ISNULL(NMP.CODCOLIGADA, N.CODCOLIGADA) = O.CODCOLIGADA
        AND ISNULL(NMP.CODFILIAL, N.CODFILIAL) = O.CODFILIAL
        AND TMP.CODCFO = O.CODCFO
        LEFT JOIN TCNTCOMPL OC (NOLOCK) ON O.CODCOLIGADA = OC.CODCOLIGADA
        AND O.IDCNT = OC.IDCNT
        LEFT JOIN FCFO P (NOLOCK) ON A.CODCFO = P.CODCFO
        AND A.CODCOLCFO = P.CODCOLIGADA
        LEFT JOIN GFILIAL Q (NOLOCK) ON A.CODFILIAL = Q.CODFILIAL
        AND A.CODCOLIGADA = Q.CODCOLIGADA
        LEFT JOIN FTRBLAN R (NOLOCK) ON A.IDLAN = R.IDLAN
        AND A.CODCOLIGADA = R.CODCOLIGADA
        LEFT JOIN TNFEENTRADA S (NOLOCK) ON TM.IDMOV = S.IDMOV
        AND TM.CODCOLIGADA = S.CODCOLIGADA
        LEFT JOIN TMOVHISTORICO T (NOLOCK) ON TM.IDMOV = T.IDMOV
        AND TM.CODCOLIGADA = T.CODCOLIGADA
        LEFT JOIN ZOPERACAOID_SAIDAS ZO (NOLOCK) ON A.CODTB3FLX = ZO.CODTB3FLX
        AND A.CODCOLIGADA = 1
        LEFT JOIN FCFOCOMPL FC (NOLOCK) ON A.CODCFO = FC.CODCFO
        AND A.CODCOLCFO = FC.CODCOLIGADA
        LEFT JOIN ZCLASSPAGAMENTO ZCL (NOLOCK) ON A.CODTB3FLX = ZCL.CODTB3FLX
        LEFT JOIN ZCLASSEFORNECEDOR2 ZC (NOLOCK) ON A.CODTB3FLX = ZC.CODTB3FLX
        AND A.CODCOLIGADA = ZC.CODCOLIGADA
        LEFT JOIN PFUNC PF (NOLOCK) ON A.CHAPA = PF.CHAPA
        LEFT JOIN PPESSOA PP (NOLOCK) ON PF.CODPESSOA = PP.CODIGO
WHERE A.CODCOLIGADA = 1
        AND A.CODFILIAL = ${CODFILIAL}
        AND B.DATABAIXA >= '${DATAINICIAL}'
        AND B.DATABAIXA <= '${DATAFINAL}'
        AND A.PAGREC = 2
        AND B.STATUS <> 1
        AND A.STATUSLAN <> 2
        AND B.VALORBAIXA = 0
        AND IC.CODCONTA LIKE '1.1.1%'
UNION
SELECT DISTINCT '0200' AS 'REG',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = b.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTACONTABIL',
        I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA',
        I.NUMBANCO AS 'CODIGO BANCO',
        J.NOME AS 'NOME BANCO',
        I.NUMAGENCIA AS 'BANCO AGNCIA',
        K.DIGAG AS 'DIG AGNCIA',
        I.NROCONTA AS CONTA,
        L.DIGCONTA AS 'DIG CONTA',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM FXCX X (NOLOCK)
                WHERE X.CODCOLIGADA = 1
                        AND B.CODFILIAL = X.CODFILIAL
                        AND B.CODCXA = X.CODCXA
                        AND X.DATACOMPENSACAO >= (
                                CASE
                                        WHEN B.CODFILIAL = 23 THEN '20231124'
                                        WHEN B.CODFILIAL = 27 THEN '20231124'
                                        WHEN B.CODFILIAL = 28 THEN '20231123'
                                        ELSE '${DATAINICIAL}'
                                END
                        )
                        AND X.DATACOMPENSACAO < '${DATAINICIAL}'
        ) AS 'SALDO PERIODO ANTERIOR',
        CASE
                WHEN A.CODTDO IN ('016', '108') THEN '31'
                WHEN A.CODTDO IN ('103', '010', '035', '043') THEN '9'
                WHEN A.CODTDO IN ('036', '052', '129') THEN 50
                ELSE ZO.OPERACAOID
        END AS 'OPERACAOID',
        ZCL.CLASSPAGAMENTO AS 'CLASS. PAGAMENTO',
        ZC.TIPOFORNECEDOR,
        ZC.CLASSEFORNECEDOR,
        CASE
                WHEN B.IDFORMAPAGTO = 1 THEN 6
                WHEN B.IDFORMAPAGTO = 2 THEN 1
                WHEN B.IDFORMAPAGTO IN (3, 4, 5, 6, 7) THEN (
                        CASE
                                WHEN FC.ESTSERV = '01' THEN 7
                                ELSE 19
                        END
                )
                ELSE 16
        END AS 'DOCTIPOID',
        B.IDXCX AS 'NOPERACAO',
        CASE
                WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV
                ELSE A.NUMERODOCUMENTO
        END AS 'NDOCFIN',
        FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'COMPETNCIA REFERENCIA',
        FORMAT(B.DATABAIXA, 'dd/MM/yyyy') AS 'DATA',
        B.VALORBAIXA AS 'VALOR',
        A.SERIEDOCUMENTO AS 'SERIENF',
        CASE
                WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV
                ELSE A.NUMERODOCUMENTO
        END AS 'NFDOC',
        FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'DATANFDOC',
        FORMAT(A.DATAVENCIMENTO, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA',
        O.CODIGOCONTRATO AS 'NCONTRATO',
        CASE
                WHEN P.CODCFO = '026614' THEN 'SUBVENO'
                ELSE OC.SERVCONTRA
        END AS 'OBJETOCONTRATO',
        O.NOME AS 'CONTRATO DESCRIO',
        CASE
                WHEN P.CGCCFO IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE P.CGCCFO
        END AS 'CNPJ CONTRATO',
        FORMAT(O.DATAINICIO, 'dd/MM/yyyy') AS 'CONTRATO INCIO VIGENCIA',
        FORMAT(O.DATAFIM, 'dd/MM/yyyy') AS 'CONTRATO FIM VIGENCIA',
        O.VALORCONTRATO AS 'VALOR CONTRATO',
        (
                SELECT ISNULL(SUM(X.VALORTOTAL), 0)
                FROM TITMCNT X (NOLOCK)
                WHERE X.IDCNT = ISNULL(NMP.IDCNT, N.IDCNT)
        ) AS 'VALOR PARC CONTRATO',
        '' AS 'SERIE PARC CONTRATO',
        CASE
                WHEN ISNULL(NMP.IDCNT, N.IDCNT) IS NOT NULL THEN 'S'
                ELSE 'N'
        END 'POSSUI CONTRATO',
        CASE
                WHEN A.CHAPA IS NOT NULL THEN PP.CPF
                WHEN P.CGCCFO IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE P.CGCCFO
        END AS 'CNPJ CPF PARTICIPANTE',
        CASE
                WHEN A.CHAPA IS NOT NULL THEN PF.NOME
                ELSE P.NOMEFANTASIA
        END AS 'NOME PARTICIPANTE',
        A.VALORORIGINAL AS 'VALOR DOC',
        ISNULL(B.VALORMULTA, 0) + ISNULL(B.VALORJUROS, 0) AS 'MULTAJUROS',
        ISNULL(TM.VALORFRETE, 0) AS 'FRETE',
        ISNULL(A.VALOROP2 + A.VALOROP6, 0) AS 'INSS',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM TTRBMOV (NOLOCK)
                WHERE CODCOLIGADA = 1
                        AND IDMOV = A.IDMOV
                        AND CODTRB = 'ICMSST'
        ) AS 'ICMSST',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM TTRBMOV (NOLOCK)
                WHERE CODCOLIGADA = 1
                        AND IDMOV = A.IDMOV
                        AND CODTRB = 'IPI'
        ) AS 'IPI',
        ISNULL(A.VALOROP1, 0) AS 'ISS',
        ISNULL(A.VALORIRRF + A.VALOROP7, 0) AS 'IR',
        0 AS 'PIS',
        0 AS 'COFINS',
        0 AS 'CSLL',
        ISNULL(R.VALOR, 0) AS 'CSRF',
        CASE
                WHEN TM.VALORDESC > 0 THEN ISNULL(TM.VALORDESC, 0)
                ELSE ISNULL(B.VALORDESCONTO, 0)
        END AS 'DESCONTO',
        CASE
                WHEN TM.CHAVEACESSONFE IS NULL THEN TM.CHAVEACESSONFE
                ELSE TM.CHAVEACESSONFE
        END AS 'CHAVE NF-E',
        CASE
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '23'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 93/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '27'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 92/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '28'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 90/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '29'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 08/2024'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '30'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 33/2024'
                )
                ELSE A.HISTORICO
        END AS 'HISTORICO',
        CAST(T.HISTORICOCURTO AS VARCHAR) + CAST(T.HISTORICOLONGO AS VARCHAR) AS 'OBS DANFE',
        'S' AS 'CONCILIADO',
        '' AS 'ARQUIVO CERTIDAO',
        ISNULL(
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'MOVMOVIMENTODATA'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'CP%'
                                AND X.CHAVE = TM.IDMOV
                ),
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'FINLANDATABR'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'CP%'
                                AND X.CHAVE = A.IDLAN
                )
        ) AS 'ARQUIVO NF',
        '' AS 'ARQUIVO CONTRATO',
        '' AS 'ARQUIVO XML',
        '' AS 'CENTRO DE CUSTO',
        'N' AS 'RETIFICADA',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = b.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTA CONTBIL GERAL',
        'N' AS 'CONTRATO PARCELA VARIAVEL',
        O.NOME AS 'CONTRATO DESCRICAO SERVICO',
        P.NOMEFANTASIA AS 'CONTRATO NOME FANTASIA',
        ISNULL(
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'MOVMOVIMENTODATA'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'DOC%'
                                AND X.CHAVE = TM.IDMOV
                ),
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'FINLANDATABR'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'DOC%'
                                AND X.CHAVE = A.IDLAN
                )
        ) AS 'ARQUIVO PESQUISA'
FROM FLAN A (NOLOCK)
        INNER JOIN FLANBAIXA B (NOLOCK) ON A.IDLAN = B.IDLAN
        AND A.CODCOLIGADA = B.CODCOLIGADA
        INNER JOIN COPERACAO C (NOLOCK) ON B.IDOPERACAO = C.IDOPERACAO
        AND B.CODCOLIGADA = C.CODCOLIGADA
        INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO
        AND C.CODCOLIGADA = D.CODCOLIGADA
        INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA
        AND D.CODCOLIGADA = E.CODCOLIGADA
        LEFT JOIN CCONTA H (NOLOCK) ON E.CREDITO = H.CODCONTA
        AND E.CODCOLCREDITO = H.CODCOLIGADA
        LEFT JOIN FCXA I (NOLOCK) ON B.CODCXA = I.CODCXA
        AND B.CODCOLCXA = I.CODCOLPROP
        LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO
        LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO
        AND I.NUMAGENCIA = K.NUMAGENCIA
        LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA
        AND I.NUMBANCO = L.NUMBANCO
        AND I.NUMAGENCIA = L.NUMAGENCIA
        LEFT JOIN TITMMOV N (NOLOCK) ON A.IDMOV = N.IDMOV
        AND A.CODCOLIGADA = N.CODCOLIGADA
        LEFT JOIN TMOV TM (NOLOCK) ON N.IDMOV = TM.IDMOV
        AND N.CODCOLIGADA = TM.CODCOLIGADA
        LEFT JOIN TMOVRELAC TMR (NOLOCK) ON TM.CODCOLIGADA = TMR.CODCOLDESTINO
        AND TM.IDMOV = TMR.IDMOVDESTINO
        LEFT JOIN TMOV TMP (NOLOCK) ON TMR.CODCOLORIGEM = TMP.CODCOLIGADA
        AND TMP.IDMOV = TMR.IDMOVORIGEM
        LEFT JOIN TITMMOV NMP (NOLOCK) ON TMP.CODCOLIGADA = NMP.CODCOLIGADA
        AND TMP.IDMOV = NMP.IDMOV
        AND NMP.NSEQITMMOV = 1
        LEFT JOIN TCNT O (NOLOCK) ON ISNULL(NMP.IDCNT, N.IDCNT) = O.IDCNT
        AND ISNULL(NMP.CODCOLIGADA, N.CODCOLIGADA) = O.CODCOLIGADA
        AND ISNULL(NMP.CODFILIAL, N.CODFILIAL) = O.CODFILIAL
        AND TMP.CODCFO = O.CODCFO
        LEFT JOIN TCNTCOMPL OC (NOLOCK) ON O.CODCOLIGADA = OC.CODCOLIGADA
        AND O.IDCNT = OC.IDCNT
        LEFT JOIN FCFO P (NOLOCK) ON A.CODCFO = P.CODCFO
        AND A.CODCOLCFO = P.CODCOLIGADA
        LEFT JOIN GFILIAL Q (NOLOCK) ON A.CODFILIAL = Q.CODFILIAL
        AND A.CODCOLIGADA = Q.CODCOLIGADA
        LEFT JOIN FTRBLAN R (NOLOCK) ON A.IDLAN = R.IDLAN
        AND A.CODCOLIGADA = R.CODCOLIGADA
        LEFT JOIN TNFEENTRADA S (NOLOCK) ON TM.IDMOV = S.IDMOV
        AND TM.CODCOLIGADA = S.CODCOLIGADA
        LEFT JOIN TMOVHISTORICO T (NOLOCK) ON TM.IDMOV = T.IDMOV
        AND TM.CODCOLIGADA = T.CODCOLIGADA
        LEFT JOIN ZOPERACAOID_SAIDAS ZO (NOLOCK) ON A.CODTB3FLX = ZO.CODTB3FLX
        AND A.CODCOLIGADA = 1
        LEFT JOIN FCFOCOMPL FC (NOLOCK) ON A.CODCFO = FC.CODCFO
        AND A.CODCOLCFO = FC.CODCOLIGADA
        LEFT JOIN ZCLASSPAGAMENTO ZCL (NOLOCK) ON A.CODTB3FLX = ZCL.CODTB3FLX
        LEFT JOIN ZCLASSEFORNECEDOR2 ZC (NOLOCK) ON A.CODTB3FLX = ZC.CODTB3FLX
        AND A.CODCOLIGADA = ZC.CODCOLIGADA
        LEFT JOIN PFUNC PF (NOLOCK) ON A.CHAPA = PF.CHAPA
        LEFT JOIN PPESSOA PP (NOLOCK) ON PF.CODPESSOA = PP.CODIGO
WHERE A.CODCOLIGADA = 1
        AND A.CODFILIAL = ${CODFILIAL}
        AND B.DATABAIXA >= '${DATAINICIAL}'
        AND B.DATABAIXA <= '${DATAFINAL}'
        AND A.PAGREC = 2
        AND B.STATUS <> 1
        AND A.STATUSLAN <> 2
        AND A.NFOUDUP <> 1
        AND E.CREDITO LIKE '1.1.1%'
UNION
SELECT DISTINCT '0200' AS 'REG',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = b.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTACONTABIL',
        I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA',
        I.NUMBANCO AS 'CODIGO BANCO',
        J.NOME AS 'NOME BANCO',
        I.NUMAGENCIA AS 'BANCO AGNCIA',
        K.DIGAG AS 'DIG AGNCIA',
        I.NROCONTA AS CONTA,
        L.DIGCONTA AS 'DIG CONTA',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM FXCX X (NOLOCK)
                WHERE X.CODCOLIGADA = 1
                        AND B.CODFILIAL = X.CODFILIAL
                        AND B.CODCXA = X.CODCXA
                        AND X.DATACOMPENSACAO >= (
                                CASE
                                        WHEN B.CODFILIAL = 23 THEN '20231124'
                                        WHEN B.CODFILIAL = 27 THEN '20231124'
                                        WHEN B.CODFILIAL = 28 THEN '20231123'
                                        ELSE '${DATAINICIAL}'
                                END
                        )
                        AND X.DATACOMPENSACAO < '${DATAINICIAL}'
        ) AS 'SALDO PERIODO ANTERIOR',
        CASE
                WHEN A.CODTDO = '999'
                AND (
                        SELECT TOP 1 CODTDO
                        FROM FLAN (NOLOCK)
                        WHERE CODCOLIGADA = 1
                                AND IDLAN IN (
                                        SELECT IDLAN
                                        FROM FRELLAN (NOLOCK)
                                        WHERE CODCOLIGADA = 1
                                                AND TIPOREL = 30
                                                AND IDLANREL = A.IDLAN
                                )
                ) IN ('108', '109', '120', '138') THEN '40'
                WHEN A.CODTDO = '999'
                AND (
                        SELECT TOP 1 CODTDO
                        FROM FLAN (NOLOCK)
                        WHERE CODCOLIGADA = 1
                                AND IDLAN IN (
                                        SELECT IDLAN
                                        FROM FRELLAN (NOLOCK)
                                        WHERE CODCOLIGADA = 1
                                                AND TIPOREL = 30
                                                AND IDLANREL = A.IDLAN
                                )
                ) IN ('111') THEN '47'
                WHEN A.CODTDO = '999'
                AND (
                        SELECT TOP 1 CODTDO
                        FROM FLAN (NOLOCK)
                        WHERE CODCOLIGADA = 1
                                AND IDLAN IN (
                                        SELECT IDLAN
                                        FROM FRELLAN (NOLOCK)
                                        WHERE CODCOLIGADA = 1
                                                AND TIPOREL = 30
                                                AND IDLANREL = A.IDLAN
                                )
                ) IN ('016') THEN '50'
                WHEN A.CODTDO IN ('016', '108') THEN '31'
                WHEN A.CODTDO IN ('103', '010', '035', '043') THEN '9'
                WHEN A.CODTDO IN ('036', '052', '129') THEN 50
                ELSE ZO.OPERACAOID
        END 'OPERACAOID',
        ZCL.CLASSPAGAMENTO AS 'CLASS. PAGAMENTO',
        ZC.TIPOFORNECEDOR,
        ZC.CLASSEFORNECEDOR,
        CASE
                WHEN B.IDFORMAPAGTO = 1 THEN 6
                WHEN B.IDFORMAPAGTO = 2 THEN 1
                WHEN B.IDFORMAPAGTO IN (3, 4, 5, 6, 7) THEN (
                        CASE
                                WHEN FC.ESTSERV = '01' THEN 7
                                ELSE 19
                        END
                )
                ELSE 16
        END AS 'DOCTIPOID',
        B.IDXCX AS 'NOPERACAO',
        CASE
                WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV
                ELSE A.NUMERODOCUMENTO
        END AS 'NDOCFIN',
        FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'COMPETNCIA REFERENCIA',
        FORMAT(B.DATABAIXA, 'dd/MM/yyyy') AS 'DATA',
        B.VALORBAIXA AS 'VALOR',
        A.SERIEDOCUMENTO AS 'SERIENF',
        CASE
                WHEN A.CODAPLICACAO = 'T' THEN TM.NUMEROMOV
                ELSE A.NUMERODOCUMENTO
        END AS 'NFDOC',
        FORMAT(A.DATAEMISSAO, 'dd/MM/yyyy') AS 'DATANFDOC',
        FORMAT(A.DATAVENCIMENTO, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA',
        O.CODIGOCONTRATO AS 'NCONTRATO',
        CASE
                WHEN P.CODCFO = '026614' THEN 'SUBVENO'
                ELSE OC.SERVCONTRA
        END AS 'OBJETOCONTRATO',
        O.NOME AS 'CONTRATO DESCRIO',
        CASE
                WHEN P.CGCCFO IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE P.CGCCFO
        END AS 'CNPJ CONTRATO',
        FORMAT(O.DATAINICIO, 'dd/MM/yyyy') AS 'CONTRATO INCIO VIGENCIA',
        FORMAT(O.DATAFIM, 'dd/MM/yyyy') AS 'CONTRATO FIM VIGENCIA',
        O.VALORCONTRATO AS 'VALOR CONTRATO',
        (
                SELECT ISNULL(SUM(X.VALORTOTAL), 0)
                FROM TITMCNT X (NOLOCK)
                WHERE X.IDCNT = NMP.IDCNT
        ) AS 'VALOR PARC CONTRATO',
        '' AS 'SERIE PARC CONTRATO',
        CASE
                WHEN NMP.IDCNT IS NOT NULL THEN 'S'
                ELSE 'N'
        END 'POSSUI CONTRATO',
        CASE
                WHEN A.CHAPA IS NOT NULL THEN PP.CPF
                WHEN P.CGCCFO IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE P.CGCCFO
        END AS 'CNPJ CPF PARTICIPANTE',
        CASE
                WHEN A.CHAPA IS NOT NULL THEN PF.NOME
                ELSE P.NOMEFANTASIA
        END AS 'NOME PARTICIPANTE',
        A.VALORORIGINAL AS 'VALOR DOC',
        ISNULL(B.VALORMULTA, 0) + ISNULL(B.VALORJUROS, 0) AS 'MULTAJUROS',
        ISNULL(TM.VALORFRETE, 0) AS 'FRETE',
        ISNULL(A.VALOROP2 + A.VALOROP6, 0) AS 'INSS',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM TTRBMOV (NOLOCK)
                WHERE CODCOLIGADA = 1
                        AND IDMOV = A.IDMOV
                        AND CODTRB = 'ICMSST'
        ) AS 'ICMSST',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM TTRBMOV (NOLOCK)
                WHERE CODCOLIGADA = 1
                        AND IDMOV = A.IDMOV
                        AND CODTRB = 'IPI'
        ) AS 'IPI',
        ISNULL(A.VALOROP1, 0) AS 'ISS',
        ISNULL(A.VALORIRRF + A.VALOROP7, 0) AS 'IR',
        0 AS 'PIS',
        0 AS 'COFINS',
        0 AS 'CSLL',
        ISNULL(R.VALOR, 0) AS 'CSRF',
        CASE
                WHEN TM.VALORDESC > 0 THEN ISNULL(TM.VALORDESC, 0)
                ELSE ISNULL(B.VALORDESCONTO, 0)
        END AS 'DESCONTO',
        CASE
                WHEN TM.CHAVEACESSONFE IS NULL THEN TM.CHAVEACESSONFE
                ELSE TM.CHAVEACESSONFE
        END AS 'CHAVE NF-E',
        CASE
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '23'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 93/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '27'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 92/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '28'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 90/2023'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '29'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 08/2024'
                )
                WHEN (
                        A.HISTORICO LIKE '%NF DE SERVIOS PRESTADOS%'
                        AND A.CODFILIAL = '30'
                ) THEN REPLACE(
                        A.HISTORICO,
                        'NF DE SERVIOS PRESTADOS',
                        'REPASSE REFERENTE AO CONTRATO DE GESTO 33/2024'
                )
                ELSE A.HISTORICO
        END AS 'HISTORICO',
        CAST(T.HISTORICOCURTO AS VARCHAR) + CAST(T.HISTORICOLONGO AS VARCHAR) AS 'OBS DANFE',
        'S' AS 'CONCILIADO',
        '' AS 'ARQUIVO CERTIDAO',
        ISNULL(
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'MOVMOVIMENTODATA'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'CP%'
                                AND X.CHAVE = TM.IDMOV
                ),
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'FINLANDATABR'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'CP%'
                                AND X.CHAVE = A.IDLAN
                )
        ) AS 'ARQUIVO NF',
        '' AS 'ARQUIVO CONTRATO',
        '' AS 'ARQUIVO XML',
        '' AS 'CENTRO DE CUSTO',
        'N' AS 'RETIFICADA',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = b.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTA CONTBIL GERAL',
        'N' AS 'CONTRATO PARCELA VARIAVEL',
        O.NOME AS 'CONTRATO DESCRICAO SERVICO',
        P.NOMEFANTASIA AS 'CONTRATO NOME FANTASIA',
        ISNULL(
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'MOVMOVIMENTODATA'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'DOC%'
                                AND X.CHAVE = TM.IDMOV
                ),
                (
                        SELECT TOP 1 CASE
                                        WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                        ELSE X.CODDOCUMENTO
                                END
                        FROM ZHCINTEGRACAOGED X (NOLOCK)
                                LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                        WHERE X.DATASERVER = 'FINLANDATABR'
                                AND xf.VERSAO_ATIVA = 1
                                AND X.DESCRICAO LIKE 'DOC%'
                                AND X.CHAVE = A.IDLAN
                )
        ) AS 'ARQUIVO PESQUISA'
FROM FLAN A (NOLOCK)
        INNER JOIN FLANBAIXA B (NOLOCK) ON A.IDLAN = B.IDLAN
        AND A.CODCOLIGADA = B.CODCOLIGADA
        INNER JOIN COPERACAO C (NOLOCK) ON B.IDOPERACAO = C.IDOPERACAO
        AND B.CODCOLIGADA = C.CODCOLIGADA
        INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO
        AND C.CODCOLIGADA = D.CODCOLIGADA
        INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA
        AND D.CODCOLIGADA = E.CODCOLIGADA
        LEFT JOIN CCONTA H (NOLOCK) ON E.DEBITO = H.CODCONTA
        AND E.CODCOLDEBITO = H.CODCOLIGADA
        LEFT JOIN FCXA I (NOLOCK) ON B.CODCXA = I.CODCXA
        AND B.CODCOLCXA = I.CODCOLPROP
        LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO
        LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO
        AND I.NUMAGENCIA = K.NUMAGENCIA
        LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA
        AND I.NUMBANCO = L.NUMBANCO
        AND I.NUMAGENCIA = L.NUMAGENCIA
        LEFT JOIN TITMMOV N (NOLOCK) ON A.IDMOV = N.IDMOV
        AND A.CODCOLIGADA = N.CODCOLIGADA
        LEFT JOIN TMOV TM (NOLOCK) ON N.IDMOV = TM.IDMOV
        AND N.CODCOLIGADA = TM.CODCOLIGADA
        LEFT JOIN TMOVRELAC TMR (NOLOCK) ON TM.CODCOLIGADA = TMR.CODCOLDESTINO
        AND TM.IDMOV = TMR.IDMOVDESTINO
        LEFT JOIN TMOV TMP (NOLOCK) ON TMR.CODCOLORIGEM = TMP.CODCOLIGADA
        AND TMP.IDMOV = TMR.IDMOVORIGEM
        LEFT JOIN TITMMOV NMP (NOLOCK) ON TMP.CODCOLIGADA = NMP.CODCOLIGADA
        AND TMP.IDMOV = NMP.IDMOV
        AND NMP.NSEQITMMOV = 1
        LEFT JOIN TCNT O (NOLOCK) ON NMP.IDCNT = O.IDCNT
        AND NMP.CODCOLIGADA = O.CODCOLIGADA
        AND NMP.CODFILIAL = O.CODFILIAL
        AND TMP.CODCFO = O.CODCFO
        LEFT JOIN TCNTCOMPL OC (NOLOCK) ON O.CODCOLIGADA = OC.CODCOLIGADA
        AND O.IDCNT = OC.IDCNT
        LEFT JOIN FCFO P (NOLOCK) ON A.CODCFO = P.CODCFO
        AND A.CODCOLCFO = P.CODCOLIGADA
        LEFT JOIN GFILIAL Q (NOLOCK) ON A.CODFILIAL = Q.CODFILIAL
        AND A.CODCOLIGADA = Q.CODCOLIGADA
        LEFT JOIN FTRBLAN R (NOLOCK) ON A.IDLAN = R.IDLAN
        AND A.CODCOLIGADA = R.CODCOLIGADA
        LEFT JOIN TNFEENTRADA S (NOLOCK) ON TM.IDMOV = S.IDMOV
        AND TM.CODCOLIGADA = S.CODCOLIGADA
        LEFT JOIN TMOVHISTORICO T (NOLOCK) ON TM.IDMOV = T.IDMOV
        AND TM.CODCOLIGADA = T.CODCOLIGADA
        LEFT JOIN ZOPERACAOID_ENTRADAS ZO (NOLOCK) ON A.CODTB5FLX = ZO.CODTB5FLX
        AND A.CODCOLIGADA = 1
        LEFT JOIN FCFOCOMPL FC (NOLOCK) ON A.CODCFO = FC.CODCFO
        AND A.CODCOLCFO = FC.CODCOLIGADA
        LEFT JOIN ZCLASSPAGAMENTO ZCL (NOLOCK) ON A.CODTB3FLX = ZCL.CODTB3FLX
        LEFT JOIN ZCLASSEFORNECEDOR2 ZC (NOLOCK) ON A.CODTB3FLX = ZC.CODTB3FLX
        AND A.CODCOLIGADA = ZC.CODCOLIGADA
        LEFT JOIN PFUNC PF (NOLOCK) ON A.CHAPA = PF.CHAPA
        LEFT JOIN PPESSOA PP (NOLOCK) ON PF.CODPESSOA = PP.CODIGO
WHERE A.CODCOLIGADA = 1
        AND A.CODFILIAL = ${CODFILIAL}
        AND B.DATABAIXA >= '${DATAINICIAL}'
        AND B.DATABAIXA <= '${DATAFINAL}'
        AND A.PAGREC = 1
        AND B.STATUS <> 1
        AND A.STATUSLAN <> 2
        AND A.NFOUDUP <> 1
        AND E.DEBITO LIKE '1.1.1%'
UNION
SELECT DISTINCT '0200' AS 'REG',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = a.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTACONTABIL',
        I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA',
        I.NUMBANCO AS 'CODIGO BANCO',
        J.NOME AS 'NOME BANCO',
        I.NUMAGENCIA AS 'BANCO AGNCIA',
        K.DIGAG AS 'DIG AGNCIA',
        I.NROCONTA AS 'CONTA',
        L.DIGCONTA AS 'DIG CONTA',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM FXCX X (NOLOCK)
                WHERE X.CODCOLIGADA = 1
                        AND A.CODFILIAL = X.CODFILIAL
                        AND A.CODCXA = X.CODCXA
                        AND X.DATACOMPENSACAO >= (
                                CASE
                                        WHEN A.CODFILIAL = 23 THEN '20231124'
                                        WHEN A.CODFILIAL = 27 THEN '20231124'
                                        WHEN A.CODFILIAL = 28 THEN '20231123'
                                        ELSE '${DATAINICIAL}'
                                END
                        )
                        AND X.DATACOMPENSACAO < '${DATAINICIAL}'
        ) AS 'SALDO PERIODO ANTERIOR',
        CASE
                WHEN A.TIPO = 3
                AND LEN(I.CODCXA) = 9
                AND (
                        (
                                SELECT LEN(CODCXATRANSF)
                                FROM FXCX
                                WHERE IDXCX = A.IDXCX
                        )
                ) <> 9
                AND A.HISTORICO LIKE 'RESGAT%' THEN 3
                WHEN A.TIPO = 3
                AND LEN(I.CODCXA) = 9
                AND (
                        (
                                SELECT LEN(CODCXATRANSF)
                                FROM FXCX
                                WHERE IDXCX = A.IDXCX
                        )
                ) <> 9
                AND A.HISTORICO LIKE 'APLICA%' THEN 3
                WHEN A.TIPO = 3
                AND LEN(I.CODCXA) <> 9
                AND (
                        (
                                SELECT LEN(CODCXATRANSF)
                                FROM FXCX
                                WHERE IDXCX = A.IDXCX
                        )
                ) = 9
                AND A.HISTORICO LIKE 'RESGAT%' THEN 11
                WHEN A.TIPO = 3
                AND LEN(I.CODCXA) <> 9
                AND (
                        (
                                SELECT LEN(CODCXATRANSF)
                                FROM FXCX
                                WHERE IDXCX = A.IDXCX
                        )
                ) = 9
                AND A.HISTORICO LIKE 'APLICA%' THEN 11
                WHEN A.TIPO = 3
                AND LEN(I.CODCXA) <> 9
                AND (
                        (
                                SELECT LEN(CODCXATRANSF)
                                FROM FXCX
                                WHERE IDXCX = A.IDXCX
                        )
                ) <> 9
                AND (
                        A.HISTORICO NOT LIKE 'APLICA%'
                        AND A.HISTORICO NOT LIKE 'RESGAT%'
                ) THEN 15
                ELSE ZO.OPERACAOID
        END AS 'OPERACAOID',
        NULL AS 'CLASS. PAGAMENTO',
        ZC.TIPOFORNECEDOR,
        NULL AS 'CLASS.FORNECEDOR',
        CASE
                WHEN A.CODTB3FLX = '06.01.01.001' THEN 13
                ELSE 16
        END 'DOCTIPOID',
        A.IDXCX AS 'NOPERACAO',
        A.NUMERODOCUMENTO AS 'NDOCFIN',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'COMPETNCIA REFERENCIA',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATA',
        ABS(A.VALOR) AS 'VALOR',
        NULL AS 'SERIENF',
        A.NUMERODOCUMENTO AS 'NFDOC',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATANFDOC',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA',
        NULL AS 'NCONTRATO',
        NULL AS 'OBJETO CONTRATO',
        NULL AS 'CONTRATO DESCRIO',
        NULL AS 'CNPJ CONTRATO',
        NULL AS 'CONTRATO INCIO VIGENCIA',
        NULL AS 'CONTRATO FIM VIGENCIA',
        0 AS 'VALOR CONTRATO',
        0 AS 'VALOR PARC CONTRATO',
        NULL AS 'SERIE PARC CONTRATO',
        'N' AS 'POSSUI CONTRATO',
        CASE
                WHEN B.CGC IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE B.CGC
        END AS 'CNPJ CPF PARTICIPANTE',
        B.NOMEFANTASIA AS 'NOME PARTICIPANTE',
        ABS(A.VALOR) AS 'VALOR DOC',
        0 AS 'MULTAJUROS',
        0 AS 'FRETE',
        0 AS 'INSS',
        0 AS 'ICMSST',
        0 AS 'IPI',
        0 AS 'ISS',
        0 AS 'IR',
        0 AS 'PIS',
        0 AS 'COFINS',
        0 AS 'CSLL',
        0 AS 'CSRF',
        0 AS 'DESCONTO',
        0 AS 'CHAVE NF-E',
        A.HISTORICO AS 'HISTORICO',
        NULL AS 'OBS DANFE',
        'S' AS 'CONCILIADO',
        '' AS 'ARQUIVO CERTIDAO',
        (
                SELECT TOP 1 CASE
                                WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                ELSE X.CODDOCUMENTO
                        END
                FROM ZHCINTEGRACAOGED X (NOLOCK)
                        LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                WHERE X.DATASERVER = 'FINXCXDATA'
                        AND xf.VERSAO_ATIVA = 1
                        AND X.CHAVE = A.IDXCX
        ) AS 'ARQUIVO NF',
        NULL AS 'ARQUIVO CONTRATO',
        NULL AS 'ARQUIVO XML',
        NULL AS 'CENTRO DE CUSTO',
        'N' AS 'RETIFICADA',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = a.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTA CONTBIL GERAL',
        'N' AS 'CONTRATO PARCELA VARIAVEL',
        NULL AS 'CONTRATO DESCRICAO SERVICO',
        NULL AS 'CONTRATO NOME FANTASIA',
        (
                SELECT TOP 1 CASE
                                WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                ELSE X.CODDOCUMENTO
                        END
                FROM ZHCINTEGRACAOGED X (NOLOCK)
                        LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                WHERE X.DATASERVER = 'FINLANDATABR'
                        AND xf.VERSAO_ATIVA = 1
                        AND X.DESCRICAO LIKE 'DOC%'
                        AND X.CHAVE = A.IDLAN
        ) AS 'ARQUIVO PESQUISA'
FROM FXCX A (NOLOCK)
        INNER JOIN GFILIAL B (NOLOCK) ON A.CODCOLIGADA = B.CODCOLIGADA
        AND A.CODFILIAL = B.CODFILIAL
        INNER JOIN COPERACAO C (NOLOCK) ON A.IDOPERACAOCONT = C.IDOPERACAO
        AND A.CODCOLIGADA = C.CODCOLIGADA
        INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO
        AND C.CODCOLIGADA = D.CODCOLIGADA
        INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA
        AND D.CODCOLIGADA = E.CODCOLIGADA
        LEFT JOIN CCONTA H (NOLOCK) ON E.CREDITO = H.CODCONTA
        AND E.CODCOLCREDITO = H.CODCOLIGADA
        LEFT JOIN FCXA I (NOLOCK) ON A.CODCXA = I.CODCXA
        AND A.CODCOLCXA = I.CODCOLPROP
        LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO
        LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO
        AND I.NUMAGENCIA = K.NUMAGENCIA
        LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA
        AND I.NUMBANCO = L.NUMBANCO
        AND I.NUMAGENCIA = L.NUMAGENCIA
        LEFT JOIN ZOPERACAOID_SAIDAS ZO (NOLOCK) ON A.CODTB3FLX = ZO.CODTB3FLX
        AND A.CODCOLIGADA = 1
        LEFT JOIN ZCLASSPAGAMENTO ZCL (NOLOCK) ON A.CODTB3FLX = ZCL.CODTB3FLX
        LEFT JOIN ZCLASSEFORNECEDOR2 ZC (NOLOCK) ON A.CODTB3FLX = ZC.CODTB3FLX
        AND A.CODCOLIGADA = ZC.CODCOLIGADA
WHERE A.CODCOLIGADA = 1
        AND A.CODFILIAL = ${CODFILIAL}
        AND A.TIPO IN(1, 3)
        AND A.DATA >= '${DATAINICIAL}'
        AND A.DATA <= '${DATAFINAL}'
        AND E.CREDITO LIKE '1.1.1%'
        AND A.COMPENSADO <> 2
UNION
SELECT DISTINCT '0200' AS 'REG',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = a.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTACONTABIL',
        I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA',
        I.NUMBANCO AS 'CODIGO BANCO',
        J.NOME AS 'NOME BANCO',
        I.NUMAGENCIA AS 'BANCO AGNCIA',
        K.DIGAG AS 'DIG AGNCIA',
        I.NROCONTA AS 'CONTA',
        L.DIGCONTA AS 'DIG CONTA',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM FXCX X (NOLOCK)
                WHERE X.CODCOLIGADA = 1
                        AND A.CODFILIAL = X.CODFILIAL
                        AND A.CODCXA = X.CODCXA
                        AND X.DATACOMPENSACAO >= (
                                CASE
                                        WHEN A.CODFILIAL = 23 THEN '20231124'
                                        WHEN A.CODFILIAL = 27 THEN '20231124'
                                        WHEN A.CODFILIAL = 28 THEN '20231123'
                                        ELSE '${DATAINICIAL}'
                                END
                        )
                        AND X.DATACOMPENSACAO < '${DATAINICIAL}'
        ) AS 'SALDO PERIODO ANTERIOR',
        ZO.OPERACAOID,
        NULL AS 'CLASS. PAGAMENTO',
        ZC.TIPOFORNECEDOR,
        NULL AS 'CLASS.FORNECEDOR',
        CASE
                WHEN A.CODTB3FLX = '06.01.01.001' THEN 13
                ELSE 16
        END 'DOCTIPOID',
        A.IDXCX AS 'NOPERACAO',
        A.NUMERODOCUMENTO AS 'NDOCFIN',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'COMPETNCIA REFERENCIA',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATA',
        ABS(A.VALOR) AS 'VALOR',
        NULL AS 'SERIENF',
        A.NUMERODOCUMENTO AS 'NFDOC',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATANFDOC',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA',
        NULL AS 'NCONTRATO',
        NULL AS 'OBJETO CONTRATO',
        NULL AS 'CONTRATO DESCRIO',
        NULL AS 'CNPJ CONTRATO',
        NULL AS 'CONTRATO INCIO VIGENCIA',
        NULL AS 'CONTRATO FIM VIGENCIA',
        0 AS 'VALOR CONTRATO',
        0 AS 'VALOR PARC CONTRATO',
        NULL AS 'SERIE PARC CONTRATO',
        'N' AS 'POSSUI CONTRATO',
        CASE
                WHEN B.CGC IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE B.CGC
        END AS 'CNPJ CPF PARTICIPANTE',
        B.NOMEFANTASIA AS 'NOME PARTICIPANTE',
        ABS(A.VALOR) AS 'VALOR DOC',
        0 AS 'MULTAJUROS',
        0 AS 'FRETE',
        0 AS 'INSS',
        0 AS 'ICMSST',
        0 AS 'IPI',
        0 AS 'ISS',
        0 AS 'IR',
        0 AS 'PIS',
        0 AS 'COFINS',
        0 AS 'CSLL',
        0 AS 'CSRF',
        0 AS 'DESCONTO',
        0 AS 'CHAVE NF-E',
        A.HISTORICO AS 'HISTORICO',
        NULL AS 'OBS DANFE',
        'S' AS 'CONCILIADO',
        '' AS 'ARQUIVO CERTIDAO',
        (
                SELECT TOP 1 CASE
                                WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                ELSE X.CODDOCUMENTO
                        END
                FROM ZHCINTEGRACAOGED X (NOLOCK)
                        LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                WHERE X.DATASERVER = 'FINXCXDATA'
                        AND xf.VERSAO_ATIVA = 1
                        AND X.CHAVE = A.IDXCX
        ) AS 'ARQUIVO NF',
        NULL AS 'ARQUIVO CONTRATO',
        NULL AS 'ARQUIVO XML',
        NULL AS 'CENTRO DE CUSTO',
        'N' AS 'RETIFICADA',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = a.codfilial
                        and pca.codconta = h.codconta
        ) AS 'CONTA CONTBIL GERAL',
        'N' AS 'CONTRATO PARCELA VARIAVEL',
        NULL AS 'CONTRATO DESCRICAO SERVICO',
        NULL AS 'CONTRATO NOME FANTASIA',
        (
                SELECT TOP 1 CASE
                                WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                ELSE X.CODDOCUMENTO
                        END
                FROM ZHCINTEGRACAOGED X (NOLOCK)
                        LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                WHERE X.DATASERVER = 'FINLANDATABR'
                        AND xf.VERSAO_ATIVA = 1
                        AND X.DESCRICAO LIKE 'DOC%'
                        AND X.CHAVE = A.IDLAN
        ) AS 'ARQUIVO PESQUISA'
FROM FXCX A (NOLOCK)
        INNER JOIN GFILIAL B (NOLOCK) ON A.CODCOLIGADA = B.CODCOLIGADA
        AND A.CODFILIAL = B.CODFILIAL
        INNER JOIN COPERACAO C (NOLOCK) ON A.IDOPERACAOCONT = C.IDOPERACAO
        AND A.CODCOLIGADA = C.CODCOLIGADA
        INNER JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO
        AND C.CODCOLIGADA = D.CODCOLIGADA
        INNER JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA
        AND D.CODCOLIGADA = E.CODCOLIGADA
        LEFT JOIN CCONTA H (NOLOCK) ON E.DEBITO = H.CODCONTA
        AND E.CODCOLDEBITO = H.CODCOLIGADA
        LEFT JOIN FCXA I (NOLOCK) ON A.CODCXA = I.CODCXA
        AND A.CODCOLCXA = I.CODCOLPROP
        LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO
        LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO
        AND I.NUMAGENCIA = K.NUMAGENCIA
        LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA
        AND I.NUMBANCO = L.NUMBANCO
        AND I.NUMAGENCIA = L.NUMAGENCIA
        LEFT JOIN ZOPERACAOID_ENTRADAS ZO (NOLOCK) ON A.CODTB5FLX = ZO.CODTB5FLX
        AND A.CODCOLIGADA = 1
        LEFT JOIN ZCLASSPAGAMENTO ZCL (NOLOCK) ON A.CODTB3FLX = ZCL.CODTB3FLX
        LEFT JOIN ZCLASSEFORNECEDOR2 ZC (NOLOCK) ON A.CODTB3FLX = ZC.CODTB3FLX
        AND A.CODCOLIGADA = ZC.CODCOLIGADA
WHERE A.CODCOLIGADA = 1
        AND A.CODFILIAL = ${CODFILIAL}
        AND A.TIPO = 2
        AND A.DATA >= '${DATAINICIAL}'
        AND A.DATA <= '${DATAFINAL}'
        AND E.DEBITO LIKE '1.1.1%'
        AND A.COMPENSADO <> 2
UNION
SELECT DISTINCT '0200' AS 'REG',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = a.codfilial
                        and pca.codconta = ic.codconta
        ) AS 'CONTACONTABIL',
        I.DESCRICAO AS 'DESCRICAO CONTA FINANCEIRA',
        I.NUMBANCO AS 'CODIGO BANCO',
        J.NOME AS 'NOME BANCO',
        I.NUMAGENCIA AS 'BANCO AGNCIA',
        K.DIGAG AS 'DIG AGNCIA',
        I.NROCONTA AS 'CONTA',
        L.DIGCONTA AS 'DIG CONTA',
        (
                SELECT ISNULL(SUM(VALOR), 0)
                FROM FXCX X (NOLOCK)
                WHERE X.CODCOLIGADA = 1
                        AND A.CODFILIAL = X.CODFILIAL
                        AND A.CODCXA = X.CODCXA
                        AND X.DATACOMPENSACAO >= (
                                CASE
                                        WHEN A.CODFILIAL = 23 THEN '20231124'
                                        WHEN A.CODFILIAL = 27 THEN '20231124'
                                        WHEN A.CODFILIAL = 28 THEN '20231123'
                                        ELSE '${DATAINICIAL}'
                                END
                        )
                        AND X.DATACOMPENSACAO < '${DATAINICIAL}'
        ) AS 'SALDO PERIODO ANTERIOR',
        CASE
                WHEN LEN(I.CODCXA) = 9
                AND (
                        (
                                SELECT LEN(CODCXA)
                                FROM FXCX (NOLOCK)
                                WHERE CODCOLIGADA = 1
                                        AND IDXCXTRANSF = (
                                                SELECT IDXCX
                                                FROM FXCX (NOLOCK)
                                                WHERE CODCOLIGADA = 1
                                                        AND IDXCX = A.IDXCX
                                        )
                        )
                ) <> 9
                AND A.HISTORICO LIKE 'RESGAT%' THEN 12
                WHEN LEN(I.CODCXA) = 9
                AND (
                        (
                                SELECT LEN(CODCXA)
                                FROM FXCX (NOLOCK)
                                WHERE CODCOLIGADA = 1
                                        AND IDXCXTRANSF = (
                                                SELECT IDXCX
                                                FROM FXCX (NOLOCK)
                                                WHERE CODCOLIGADA = 1
                                                        AND IDXCX = A.IDXCX
                                        )
                        )
                ) <> 9
                AND A.HISTORICO LIKE 'APLIC%' THEN 12
                WHEN LEN(I.CODCXA) <> 9
                AND (
                        (
                                SELECT LEN(CODCXA)
                                FROM FXCX (NOLOCK)
                                WHERE CODCOLIGADA = 1
                                        AND IDXCXTRANSF = (
                                                SELECT IDXCX
                                                FROM FXCX (NOLOCK)
                                                WHERE CODCOLIGADA = 1
                                                        AND IDXCX = A.IDXCX
                                        )
                        )
                ) = 9 THEN 14
                WHEN LEN(I.CODCXA) <> 9
                AND (
                        (
                                SELECT LEN(CODCXA)
                                FROM FXCX (NOLOCK)
                                WHERE CODCOLIGADA = 1
                                        AND IDXCXTRANSF = (
                                                SELECT IDXCX
                                                FROM FXCX (NOLOCK)
                                                WHERE CODCOLIGADA = 1
                                                        AND IDXCX = A.IDXCX
                                        )
                        )
                ) <> 9 THEN 16
                ELSE ZO.OPERACAOID
        END AS OPERACAOID,
        NULL AS 'CLASS. PAGAMENTO',
        ZC.TIPOFORNECEDOR,
        NULL AS 'CLASS.FORNECEDOR',
        CASE
                WHEN A.CODTB3FLX = '06.01.01.001' THEN 13
                ELSE 16
        END 'DOCTIPOID',
        A.IDXCX AS 'NOPERACAO',
        A.NUMERODOCUMENTO AS 'NDOCFIN',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'COMPETNCIA REFERENCIA',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATA',
        ABS(A.VALOR) AS 'VALOR',
        NULL AS 'SERIENF',
        A.NUMERODOCUMENTO AS 'NFDOC',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'DATANFDOC',
        FORMAT(A.DATA, 'dd/MM/yyyy') AS 'VENCIMENTO NOTA',
        NULL AS 'NCONTRATO',
        NULL AS 'OBJETO CONTRATO',
        NULL AS 'CONTRATO DESCRIO',
        NULL AS 'CNPJ CONTRATO',
        NULL AS 'CONTRATO INCIO VIGENCIA',
        NULL AS 'CONTRATO FIM VIGENCIA',
        0 AS 'VALOR CONTRATO',
        0 AS 'VALOR PARC CONTRATO',
        NULL AS 'SERIE PARC CONTRATO',
        'N' AS 'POSSUI CONTRATO',
        CASE
                WHEN B.CGC IN(
                        '21.583.042/0023-88',
                        '21.583.042/0027-01',
                        '21.583.042/0028-92',
                        '21.583.042/0029-73',
                        '21.583.042/0030-07'
                ) THEN '21.583.042/0001-72'
                ELSE B.CGC
        END AS 'CNPJ CPF PARTICIPANTE',
        B.NOMEFANTASIA AS 'NOME PARTICIPANTE',
        ABS(A.VALOR) AS 'VALOR DOC',
        0 AS 'MULTAJUROS',
        0 AS 'FRETE',
        0 AS 'INSS',
        0 AS 'ICMSST',
        0 AS 'IPI',
        0 AS 'ISS',
        0 AS 'IR',
        0 AS 'PIS',
        0 AS 'COFINS',
        0 AS 'CSLL',
        0 AS 'CSRF',
        0 AS 'DESCONTO',
        0 AS 'CHAVE NF-E',
        A.HISTORICO AS 'HISTORICO',
        NULL AS 'OBS DANFE',
        'S' AS 'CONCILIADO',
        '' AS 'ARQUIVO CERTIDAO',
        (
                SELECT TOP 1 CASE
                                WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                ELSE X.CODDOCUMENTO
                        END
                FROM ZHCINTEGRACAOGED X (NOLOCK)
                        LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                WHERE X.DATASERVER = 'FINXCXDATA'
                        AND xf.VERSAO_ATIVA = 1
                        AND X.CHAVE = A.IDXCX
        ) AS 'ARQUIVO NF',
        NULL AS 'ARQUIVO CONTRATO',
        NULL AS 'ARQUIVO XML',
        NULL AS 'CENTRO DE CUSTO',
        'N' AS 'RETIFICADA',
        (
                select codconta2
                from cctacta2 pca (nolock)
                        left join cparalelo pcb (nolock) on pca.codcoligada = pcb.codcoligada
                        and pca.codparalelo = pcb.codparalelo
                where pcb.codfilial = a.codfilial
                        and pca.codconta = ic.codconta
        ) AS 'CONTA CONTBIL GERAL',
        'N' AS 'CONTRATO PARCELA VARIAVEL',
        NULL AS 'CONTRATO DESCRICAO SERVICO',
        NULL AS 'CONTRATO NOME FANTASIA',
        (
                SELECT TOP 1 CASE
                                WHEN X.CODDOCUMENTO IS NULL THEN 'DEPENDE HMTJ'
                                ELSE X.CODDOCUMENTO
                        END
                FROM ZHCINTEGRACAOGED X (NOLOCK)
                        LEFT JOIN fluig.dbo.DOCUMENTO XF (NOLOCK) ON X.CODDOCUMENTO = XF.NR_DOCUMENTO
                WHERE X.DATASERVER = 'FINLANDATABR'
                        AND xf.VERSAO_ATIVA = 1
                        AND X.DESCRICAO LIKE 'DOC%'
                        AND X.CHAVE = A.IDLAN
        ) AS 'ARQUIVO PESQUISA'
FROM FXCX A (NOLOCK)
        INNER JOIN GFILIAL B (NOLOCK) ON A.CODCOLIGADA = B.CODCOLIGADA
        AND A.CODFILIAL = B.CODFILIAL
        LEFT JOIN COPERACAO C (NOLOCK) ON A.IDOPERACAOCONT = C.IDOPERACAO
        AND A.CODCOLIGADA = C.CODCOLIGADA
        LEFT JOIN CCONT D (NOLOCK) ON C.IDOPERACAO = D.IDOPERACAO
        AND C.CODCOLIGADA = D.CODCOLIGADA
        LEFT JOIN CPARTIDA E (NOLOCK) ON D.IDPARTIDA = E.IDPARTIDA
        AND D.CODCOLIGADA = E.CODCOLIGADA
        AND E.DEBITO LIKE '1.1.1%'
        LEFT JOIN CCONTA H (NOLOCK) ON E.DEBITO = H.CODCONTA
        AND E.CODCOLDEBITO = H.CODCOLIGADA
        LEFT JOIN FCXA I (NOLOCK) ON A.CODCXA = I.CODCXA
        AND A.CODCOLCXA = I.CODCOLPROP
        LEFT JOIN FCXACONT IC (NOLOCK) ON I.CODCOLIGADA = IC.CODCOLIGADA
        AND I.CODCXA = IC.CODCXA
        AND IC.CODCONTA LIKE '1.1.1%'
        LEFT JOIN GBANCO J (NOLOCK) ON I.NUMBANCO = J.NUMBANCO
        LEFT JOIN GAGENCIA K (NOLOCK) ON J.NUMBANCO = K.NUMBANCO
        AND I.NUMAGENCIA = K.NUMAGENCIA
        LEFT JOIN FCONTA L (NOLOCK) ON I.NROCONTA = L.NROCONTA
        AND I.NUMBANCO = L.NUMBANCO
        AND I.NUMAGENCIA = L.NUMAGENCIA
        LEFT JOIN ZOPERACAOID_ENTRADAS ZO (NOLOCK) ON A.CODTB5FLX = ZO.CODTB5FLX
        AND A.CODCOLIGADA = 1
        LEFT JOIN ZCLASSPAGAMENTO ZCL (NOLOCK) ON A.CODTB3FLX = ZCL.CODTB3FLX
        LEFT JOIN ZCLASSEFORNECEDOR2 ZC (NOLOCK) ON A.CODTB3FLX = ZC.CODTB3FLX
        AND A.CODCOLIGADA = ZC.CODCOLIGADA
WHERE A.CODCOLIGADA = 1
        AND A.TIPO = 4
        AND A.COMPENSADO <> 2
        AND A.CODFILIAL = ${CODFILIAL}
        AND A.DATA >= '${DATAINICIAL}'
        AND A.DATA <= '${DATAFINAL}'`
	return sql
}

const sqlCustos = (CODFILIAL_S, DATA_INICIAL_D, DATA_FIM_D) => {
	const sql = `
	USE ${db};
	SELECT 
		HCINTEGRACAOGED.CODDOCUMENTO AS 'CODDOCUMENTO',
		'Vazio' as 'Fornecedor',
		'Vazio' as 'Filial',
		FORMAT(D.DT_CRIACAO, 'dd-MM-yyyy') AS 'Data de Emissão' DT_CRIACAO,
		FORMAT(FLAN.DATABAIXA, 'dd-MM-yyyy') AS 'Data de Baixa'
	FROM TMOV
		LEFT JOIN HCINTEGRACAOGED ON TMOV.IDMOV = SUBSTRING(HCINTEGRACAOGED.CHAVERM, 3, 7)
		LEFT JOIN FLAN ON TMOV.CODCOLIGADA = FLAN.CODCOLIGADA
		AND TMOV.IDMOV = FLAN.IDMOV
		LEFT JOIN FLANBAIXA ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
		AND FLANBAIXA.IDLAN = FLAN.IDLAN
	WHERE FLANBAIXA.DATABAIXA BETWEEN '${DATA_INICIAL_D}' AND '${DATA_FIM_D}'
		AND TMOV.CODFILIAL = ${CODFILIAL_S}
		AND HCINTEGRACAOGED.DATASERVER = 'MovMovimentoData'
		AND HCINTEGRACAOGED.DESCRICAO LIKE 'DOC%'
		AND FLAN.CODTDO <> '999'
		AND FLANBAIXA.STATUS IN (0, 4)
	UNION
	SELECT 
		HCINTEGRACAOGED.CODDOCUMENTO AS 'CODDOCUMENTO',
		'Vazio' as 'Fornecedor',
		'Vazio' as 'Filial',
		FORMAT(FLAN.DATAEMISSAO, 'dd-MM-yyyy') AS 'Data de Emissão',
		FORMAT(FLAN.DATABAIXA, 'dd-MM-yyyy') AS 'Data de Baixa'
	FROM FLAN
		LEFT JOIN FLANBAIXA ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
		AND FLAN.IDLAN = FLANBAIXA.IDLAN
		LEFT JOIN HCINTEGRACAOGED ON FLAN.IDLAN = SUBSTRING(HCINTEGRACAOGED.CHAVERM, 3, 7)
	WHERE FLANBAIXA.DATABAIXA BETWEEN '${DATA_INICIAL_D}' AND '${DATA_FIM_D}'
		AND FLAN.CODFILIAL = ${CODFILIAL_S}
		AND HCINTEGRACAOGED.DATASERVER = 'FinLanDataBR'
		AND (
			HCINTEGRACAOGED.DESCRICAO LIKE 'DOC%'
			OR HCINTEGRACAOGED.DESCRICAO LIKE 'CP_%'
		)
		AND FLAN.CODTDO <> '999'
		AND FLANBAIXA.STATUS IN (0, 4)
	UNION
	SELECT
		HCINTEGRACAOGED.CODDOCUMENTO AS 'CODDOCUMENTO',
		'Vazio' as 'Fornecedor',
		'Vazio' as 'Filial',
		FORMAT(FLAN.DATAEMISSAO, 'dd-MM-yyyy') AS 'Data de Emissão',
		FORMAT(FLAN.DATABAIXA, 'dd-MM-yyyy') AS 'Data de Baixa'
	FROM TMOV
		LEFT JOIN HCINTEGRACAOGED ON TMOV.IDMOV = SUBSTRING(HCINTEGRACAOGED.CHAVERM, 3, 7)
		LEFT JOIN FLAN ON TMOV.CODCOLIGADA = FLAN.CODCOLIGADA
		AND TMOV.IDMOV = FLAN.IDMOV
		LEFT JOIN FLANBAIXA ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
		AND FLANBAIXA.IDLAN = FLAN.IDLAN
	WHERE FLAN.DATABAIXA BETWEEN '${DATA_INICIAL_D}' AND '${DATA_FIM_D}'
		AND TMOV.CODFILIAL = ${CODFILIAL_S}
		AND HCINTEGRACAOGED.DATASERVER = 'MovMovimentoData'
		AND HCINTEGRACAOGED.DESCRICAO LIKE 'DOC%'
		AND FLAN.CODTDO <> '999'
		AND FLAN.STATUSLAN IN (1, 4)
	UNION
	SELECT
		HCINTEGRACAOGED.CODDOCUMENTO AS 'CODDOCUMENTO',
		'Vazio' as 'Fornecedor',
		'Vazio' as 'Filial',
		FORMAT(FLAN.DATAEMISSAO, 'dd-MM-yyyy') AS 'Data de Emissão',
		FORMAT(FLAN.DATABAIXA, 'dd-MM-yyyy') AS 'Data de Baixa'
	FROM FLAN
		LEFT JOIN FLANBAIXA ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
		AND FLAN.IDLAN = FLANBAIXA.IDLAN
		LEFT JOIN HCINTEGRACAOGED ON FLAN.IDLAN = SUBSTRING(HCINTEGRACAOGED.CHAVERM, 3, 7)
	WHERE FLAN.DATABAIXA BETWEEN '${DATA_INICIAL_D}' AND '${DATA_FIM_D}'
		AND FLAN.CODFILIAL = ${CODFILIAL_S}
		AND HCINTEGRACAOGED.DATASERVER = 'FinLanDataBR'
		AND (
			HCINTEGRACAOGED.DESCRICAO LIKE 'DOC%'
			OR HCINTEGRACAOGED.DESCRICAO LIKE 'CP_%'
		)
		AND FLAN.CODTDO <> '999'
		AND FLAN.STATUSLAN IN (1, 4)
	UNION
	SELECT 
		HCINTEGRACAOGED.CODDOCUMENTO AS 'CODDOCUMENTO',
		'Vazio' as 'Fornecedor',
		'Vazio' as 'Filial',
		FORMAT(FXCX.DATA,'dd-MM-yyyy'),
		FORMAT(FXCX.DATACOMPENSACAO,'dd-MM-yyyy')
	FROM FXCX
		LEFT JOIN HCINTEGRACAOGED ON FXCX.IDXCX = SUBSTRING(HCINTEGRACAOGED.CHAVERM, 3, 7)
	WHERE FXCX.DATACOMPENSACAO BETWEEN '${DATA_INICIAL_D}' AND '${DATA_FIM_D}'
		AND FXCX.CODFILIAL = ${CODFILIAL_S}
		AND FXCX.CODTB3FLX = '06.01.01.001'
		AND HCINTEGRACAOGED.DATASERVER = 'FinXCXData'
	ORDER BY HCINTEGRACAOGED.CODDOCUMENTO`
	return sql
}

const sqlSesmt = (CODFILIAL, INICIO, FIM, TIPO) => {
	var sql = `SELECT
	D.NR_DOCUMENTO COD_DOCUMENTO,
	D.DS_PRINCIPAL_DOCUMENTO NOME_DOCUMENTO,
	FORMAT(D.DT_CRIACAO, 'dd-MM-yyyy') DT_CRIACAO,
	F.CODFILIAL,
	F.CHAPA,
	F.NOME,
	CASE
		WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '01' THEN 'ASO Admissional'
		WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '02' THEN 'ASO Periódico'
		WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '03' THEN 'ASO Demissional'
		WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '04' THEN 'ASO Mudança de função'
		WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '07' THEN 'ASO Retorno ao trabalho'
		WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '11' THEN 'Ficha EPI'
		ELSE SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2)
	END AS TIPO_DOCUMENTO,
	F.CODSITUACAO SITUACAO,
	(SELECT PF.NOME FROM ${db}.dbo.PFUNCAO (NOLOCK) PF WHERE PF.CODIGO = F.CODFUNCAO) FUNCAO,
	(SELECT PS.DESCRICAO FROM ${db}.dbo.PSECAO (NOLOCK) PS WHERE PS.CODIGO = F.CODSECAO) SETOR
	FROM fluig.dbo.DOCUMENTO D (NOLOCK)
	JOIN ${db}.dbo.PFUNC (NOLOCK) F ON F.CHAPA COLLATE Latin1_General_CI_AS = RIGHT(REPLACE(D.DS_PRINCIPAL_DOCUMENTO, '.pdf', ''),CHARINDEX('_',REVERSE(REPLACE(D.DS_PRINCIPAL_DOCUMENTO, '.pdf', ''))) - 1)
	WHERE F.CODFILIAL = ${CODFILIAL} AND D.VERSAO_ATIVA = 1
	AND DT_CRIACAO BETWEEN '${INICIO}' AND '${FIM}' AND LEN(DS_PRINCIPAL_DOCUMENTO) = 31 AND DS_PRINCIPAL_DOCUMENTO LIKE '%%_05.0[12347]%'`
	if (TIPO != "Todos") {
		sql += `
		AND CASE
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '01' THEN 'ASO Admissional'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '02' THEN 'ASO Periódico'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '03' THEN 'ASO Demissional'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '04' THEN 'ASO Mudança de função'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '07' THEN 'ASO Retorno ao trabalho'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '11' THEN 'Ficha EPI '
				ELSE SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2)
			END = '${TIPO}'`
	}
	sql += ` UNION ALL SELECT 
		D.NR_DOCUMENTO COD_DOCUMENTO,
		D.DS_PRINCIPAL_DOCUMENTO NOME_DOCUMENTO,
		FORMAT(D.DT_CRIACAO, 'dd-MM-yyyy') DT_CRIACAO,
		F.CODFILIAL,
		F.CHAPA,
		F.NOME,
		CASE
			WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '01' THEN 'ASO Admissional'
			WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '02' THEN 'ASO Periódico'
			WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '03' THEN 'ASO Demissional'
			WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '04' THEN 'ASO Mudança de função'
			WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '07' THEN 'ASO Retorno ao trabalho'
			WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '11' THEN 'Ficha EPI'
			ELSE SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2)
		END AS TIPO_DOCUMENTO,
		F.CODSITUACAO SITUACAO,
		(SELECT PF.NOME FROM ${db}.dbo.PFUNCAO (NOLOCK) PF WHERE PF.CODIGO = F.CODFUNCAO) FUNCAO,
		(SELECT PS.DESCRICAO FROM ${db}.dbo.PSECAO (NOLOCK) PS WHERE PS.CODIGO = F.CODSECAO) SETOR
	FROM fluig.dbo.DOCUMENTO D (NOLOCK)
		JOIN ${db}.dbo.PFUNC (NOLOCK) F ON F.CHAPA COLLATE Latin1_General_CI_AS = RIGHT(REPLACE(D.DS_PRINCIPAL_DOCUMENTO, '.pdf', ''),CHARINDEX('_',REVERSE(REPLACE(D.DS_PRINCIPAL_DOCUMENTO, '.pdf', ''))) - 1)
		WHERE F.CODFILIAL = ${CODFILIAL} AND D.VERSAO_ATIVA = 1
		AND DT_CRIACAO BETWEEN '${INICIO}' AND '${FIM}' AND LEN(DS_PRINCIPAL_DOCUMENTO) = 31 AND DS_PRINCIPAL_DOCUMENTO LIKE '%%_05.11%'`
	if (TIPO != "Todos") {
		sql += `
			AND CASE
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '01' THEN 'ASO Admissional'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '02' THEN 'ASO Periódico'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '03' THEN 'ASO Demissional'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '04' THEN 'ASO Mudança de função'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '07' THEN 'ASO Retorno ao trabalho'
				WHEN SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2) = '11' THEN 'Ficha EPI '
				ELSE SUBSTRING(D.DS_PRINCIPAL_DOCUMENTO,CHARINDEX('_05.', D.DS_PRINCIPAL_DOCUMENTO) + LEN('_05.'),2)
			END = '${TIPO}'`
	}
	return sql
}

const sqlLists = (CODFILIAL, INICIO, FIM, TIPO) => {
	const sql = `
	SELECT DISTINCT CONCAT(
        'MERGED_',
        REPLACE(REPLACE(B.DESCRICAO, 'DOC_', ''), '.PDF', ''),
        '.PDF'
    ) NOMENCLATURA,
    B.CODDOCUMENTO DOC,
    (
        SELECT DISTINCT HCINTEGRACAOGED.CODDOCUMENTO
        FROM FLAN
            LEFT JOIN FLANBAIXA ON FLAN.CODCOLIGADA = FLANBAIXA.CODCOLIGADA
            AND FLAN.IDLAN = FLANBAIXA.IDLAN
            LEFT JOIN HCINTEGRACAOGED ON FLAN.IDLAN = TRY_CONVERT(INT, Substring(HCINTEGRACAOGED.CHAVERM, 3, 7))
            JOIN CPARTIDA ON CONVERT(VARCHAR, FLAN.IDLAN) = Substring(CPARTIDA.INTEGRACHAVE, 2, 7)
        WHERE FLAN.DATAEMISSAO BETWEEN '${INICIO}' AND '${FIM}'
            AND FLAN.CODFILIAL = ${CODFILIAL}
            AND HCINTEGRACAOGED.DATASERVER = 'FinLanDataBR'
            AND (
                HCINTEGRACAOGED.DESCRICAO LIKE 'DOC%'
                OR HCINTEGRACAOGED.DESCRICAO LIKE 'CP_%'
            )
            AND FLAN.CODTDO <> '999'
            AND FLAN.NFOUDUP = '0'
            AND CPARTIDA.INTEGRAAPLICACAO = 'F'
            AND CPARTIDA.CODCCUSTO IN (
                '01.01.002.001',
                '01.01.002.002',
                '01.01.002.003',
                '01.01.002.004',
                '01.01.002.005',
                '01.01.002.006',
                '01.01.002.007',
                '01.01.002.008',
                '01.01.002.010',
                '01.01.002.011',
                '01.01.002.012',
                '01.01.002.018',
                '01.01.002.019',
                '01.01.002.020',
                '01.02.001.001',
                '01.02.001.002',
                '01.02.001.003',
                '01.02.001.004',
                '01.02.001.005',
                '01.02.001.006',
                '01.02.001.007',
                '01.02.001.008',
                '01.02.001.009',
                '01.02.001.010',
                '01.02.002.004.0005',
                '01.02.002.004.0008',
                '01.02.002.004.0011',
                '01.05.002.002.0001',
                '01.05.003.003.0001',
                '01.05.004.003.0001',
                '01.05.005.003.0001'
            )
            AND REPLACE(
                REPLACE(HCINTEGRACAOGED.DESCRICAO, 'CP_', ''),
                '01.PDF',
                ''
            ) = REPLACE(REPLACE(B.DESCRICAO, 'DOC_', ''), '.PDF', '')
    ) CP
FROM TMOV A
    LEFT JOIN HCINTEGRACAOGED B ON A.IDMOV = TRY_CONVERT(INT, Substring(B.CHAVERM, 3, 7))
    LEFT JOIN FLAN C ON A.CODCOLIGADA = C.CODCOLIGADA
    AND A.IDMOV = C.IDMOV
    LEFT JOIN FLANBAIXA D ON C.CODCOLIGADA = D.CODCOLIGADA
    AND D.IDLAN = C.IDLAN
    JOIN CPARTIDA E ON A.IDMOV = E.INTEGRACHAVE
WHERE C.DATAEMISSAO BETWEEN '${INICIO}' AND '${FIM}'
    AND A.CODFILIAL = ${CODFILIAL}
    AND B.DATASERVER = 'MovMovimentoData'
    AND B.DESCRICAO LIKE 'DOC%'
    AND C.CODTDO <> '999'
    AND C.NFOUDUP = '0'
    AND E.INTEGRAAPLICACAO = 'T'
    AND E.CODCCUSTO IN (
        '01.01.002.001',
        '01.01.002.002',
        '01.01.002.003',
        '01.01.002.004',
        '01.01.002.005',
        '01.01.002.006',
        '01.01.002.007',
        '01.01.002.008',
        '01.01.002.010',
        '01.01.002.011',
        '01.01.002.012',
        '01.01.002.018',
        '01.01.002.019',
        '01.01.002.020',
        '01.02.001.001',
        '01.02.001.002',
        '01.02.001.003',
        '01.02.001.004',
        '01.02.001.005',
        '01.02.001.006',
        '01.02.001.007',
        '01.02.001.008',
        '01.02.001.009',
        '01.02.001.010',
        '01.02.002.004.0005',
        '01.02.002.004.0008',
        '01.02.002.004.0011',
        '01.05.002.002.0001',
        '01.05.003.003.0001',
        '01.05.004.003.0001',
        '01.05.005.003.0001'
    )`
	return sql
}
module.exports = { sqlSipef, sqlCustos, sqlSesmt, sqlLists, sqlSipef_nova };